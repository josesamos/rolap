<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Performing Multidimensional Queries (also Including Geographic Attributes) • rolap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Performing Multidimensional Queries (also Including Geographic Attributes)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rolap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rolap.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v05-flat-table-op.html">Obtaining and transforming flat tables</a></li>
    <li><a class="dropdown-item" href="../articles/v10-rpd.html">Definition of role-playing and role dimensions</a></li>
    <li><a class="dropdown-item" href="../articles/v40-refresh.html">Incremental refresh of star databases</a></li>
    <li><a class="dropdown-item" href="../articles/v50-deploy.html">Deployment of star databases with incremental refresh</a></li>
    <li><a class="dropdown-item" href="../articles/v60-export.html">Star Database Export Features</a></li>
    <li><a class="dropdown-item" href="../articles/v70-star_query.html">Performing Multidimensional Queries (also Including Geographic Attributes)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/josesamos/rolap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="v70-star_query_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="v70-star_query_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="v70-star_query_files/viz-1.8.2/viz.js"></script><link href="v70-star_query_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="v70-star_query_files/grViz-binding-1.0.11/grViz.js"></script><script src="v70-star_query_files/pivottabler-binding-1.5.6/pivottabler.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Performing Multidimensional Queries (also Including Geographic Attributes)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/rolap/blob/master/vignettes/v70-star_query.Rmd" class="external-link"><code>vignettes/v70-star_query.Rmd</code></a></small>
      <div class="d-none name"><code>v70-star_query.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Once we developed a star database in R using the <code>rolap</code>
package, in addition to exporting it to exploit it with other tools, we
can perform multidimensional queries from R: The <code>rolap</code>
package provides the functionality to define geographic attributes and
formulate and execute simple queries on a multidimensional schema that
includes them.</p>
<p>The main objective of this document is to show the multidimensional
query formulation and execution functionality offered by this package.
First, the data model is briefly discussed: the possibility of defining
stars and constellations. Then, the geographic attributes definition
functionality is also shown. Next, the functions defined to support
multidimensional queries are presented. Finally, finish with the
conclusions.</p>
</div>
<div class="section level2">
<h2 id="stars-and-constellations">Stars and constellations<a class="anchor" aria-label="anchor" href="#stars-and-constellations"></a>
</h2>
<p>Strictly speaking, a <em>star</em> is composed of a fact table and
several associated dimension tables. A <em>constellation</em> is made up
of several stars that can share dimensions. In the <code>rolap</code>
package they are treated in a unified way under the
<code>star_database</code> class: It is used both to define stars and
constellations.</p>
<p>The variable <code>mrs_db</code>, obtained in the vignette titled
<em>Obtaining and transforming flat tables</em>,
<code><a href="../articles/v05-flat-table-op.html">vignette("v05-flat-table-op")</a></code>, contains an object of class
<code>star_database</code> that we will use in the example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">mrs_db</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "star_database"</span></span></code></pre></div>
<p>We can see a representation of the tables it contains using the
<code><a href="../reference/draw_tables.html">draw_tables()</a></code> function, as shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/draw_tables.html">draw_tables</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"mrs_age\" [id = \"mrs_age\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_age<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_key\">who_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"mrs_cause\" [id = \"mrs_cause\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_cause<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">pneumonia_and_influenza_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">year<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week_ending_date<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">region<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city_state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">status<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">pop<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">lat<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">long<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who\" [id = \"who\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_key\"><U>who_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">age<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"mrs_cause\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_cause_1\"]\n\"mrs_age\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_age_1\"]\n\"mrs_cause\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_cause_2\"]\n\"mrs_age\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_age_2\"]\n\"mrs_age\":\"who_key\"->\"who\":\"who_key\" [id=\"mrs_age_3\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>We can see that it is a constellation because it contains more than
one fact table.</p>
</div>
<div class="section level2">
<h2 id="include-geographic-information-layers">Include geographic information layers<a class="anchor" aria-label="anchor" href="#include-geographic-information-layers"></a>
</h2>
<p>The <code>rolap</code> package allows us to include layers of
geographic information associated with dimension attributes. The
objective is to be able to obtain layers of geographic information with
the data contained in the multidimensional database.</p>
<p>In the considered case, the table of dimension <em>where</em>
contains geographical information in the form of the coordinates
(latitude and longitude) of each city. We can define the
<code>city</code> field as a geographic attribute.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db_geo</span> <span class="op">&lt;-</span> <span class="va">mrs_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attribute <span class="op">=</span> <span class="st">"city"</span>,</span>
<span>    from_attribute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can also associate the geographic information of a vector layer of
points or polygons to an attribute (or set of attributes), using the
same function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db_geo</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attribute <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>    from_layer <span class="op">=</span> <span class="va">us_layer_state</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"STUSPS"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The vector layer used is defined at the state level. If there is
another field at another level of detail in the layer, the same layer
can be used to define other attributes of coarser granularity.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db_geo</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attribute <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>    from_layer <span class="op">=</span> <span class="va">us_layer_state</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"DIVISION"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>If there is no field in the layer that allows us to establish the
relationship, the information associated with other attributes of the
dimension can be used.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db_geo_2</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_geoattribute.html">define_geoattribute</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attribute <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>    from_attribute <span class="op">=</span> <span class="st">"state"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>If there are still unrelated instances of the dimension, the
<code><a href="../reference/define_geoattribute.html">define_geoattribute()</a></code> function warns and the instances can
be consulted using the <code><a href="../reference/check_geoattribute_geometry.html">check_geoattribute_geometry()</a></code>
function.</p>
<p>Through these functions we have defined relationships between the
attributes and vector layers of geographic information, at the level of
detail we need, which we can later take advantage of.</p>
</div>
<div class="section level2">
<h2 id="query-functions">Query functions<a class="anchor" aria-label="anchor" href="#query-functions"></a>
</h2>
<p>A query is defined on a <code>star_database</code> object and the
result of executing it is another <code>star_database</code> object.</p>
<p>This section presents the functions available to define queries.</p>
<div class="section level3">
<h3 id="star_query">
<code>star_query()</code><a class="anchor" aria-label="anchor" href="#star_query"></a>
</h3>
<p>From a <code>star_database</code> object, an empty
<code>star_query</code> object is created where we can select fact
measures, dimension attributes and filter dimension rows.</p>
<p>Example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/star_query.html">star_query</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At least one fact table with one dimension must be included in each
query.</p>
</div>
<div class="section level3">
<h3 id="select_fact">
<code>select_fact()</code><a class="anchor" aria-label="anchor" href="#select_fact"></a>
</h3>
<p>To define the fact table to be consulted, its name is indicated,
optionally, a vector of names of selected measures and another of
aggregation functions are also indicated. If the name of any of the
measures is not indicated, the measure corresponding to the number of
rows added will be included, which is always included. If no aggregation
function is included, those defined for the measures are considered.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_1</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>    measures <span class="op">=</span> <span class="st">"all_deaths"</span>,</span>
<span>    agg_functions <span class="op">=</span> <span class="st">"MAX"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The measure is considered with the indicated aggregation function. In
addition, the measure corresponding to the number of grouped records
that make up the result is automatically included.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_2</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>              measures <span class="op">=</span> <span class="st">"all_deaths"</span><span class="op">)</span></span></code></pre></div>
<p>The measure is considered with the aggregation function defined in
the multidimensional scheme.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_3</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_age"</span><span class="op">)</span></span></code></pre></div>
<p>Only the measure corresponding to the number of grouped records is
included.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_4</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>              measures <span class="op">=</span> <span class="st">"all_deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_cause"</span><span class="op">)</span></span></code></pre></div>
<p>In a query we can select several fact tables, at least we have to
select one.</p>
</div>
<div class="section level3">
<h3 id="select_dimension">
<code>select_dimension()</code><a class="anchor" aria-label="anchor" href="#select_dimension"></a>
</h3>
<p>To include a dimension in a <code>star_query</code> object, we have
to define its name and a subset of the dimension attributes. If only the
name of the dimension is indicated, it is considered that all its
attributes should be added.</p>
<p>Example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_1</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"city"</span>, <span class="st">"state"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Only the indicated attributes of the dimension will be included.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_2</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span><span class="op">)</span></span></code></pre></div>
<p>All attributes of the dimension will be included.</p>
</div>
<div class="section level3">
<h3 id="filter_dimension">
<code>filter_dimension()</code><a class="anchor" aria-label="anchor" href="#filter_dimension"></a>
</h3>
<p>Allows us to define selection conditions for dimension rows.
Conditions can be defined on any attribute of the dimension, not only on
attributes selected in the query for the dimension. They can also be
defined on unselected dimensions. Filtering is done using the function
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code>. Conditions are defined in exactly the same
way as in that function.</p>
<p>Example:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_dimension.html">filter_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>, <span class="va">week</span> <span class="op">&lt;=</span> <span class="st">" 3"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_dimension.html">filter_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">city</span> <span class="op">==</span> <span class="st">"Bridgeport"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run_query">
<code>run_query()</code><a class="anchor" aria-label="anchor" href="#run_query"></a>
</h3>
<p>Once we have selected the facts, dimensions and defined the
conditions on the instances of dimensions, we can execute the query to
obtain the result.</p>
<p>The query can be executed on any <code>star_database</code> object
that has in its structure the elements that appear in it. If the
<code>star_database</code> has geographic information associated with
it, this will be filtered according to its conditions.</p>
<p>Example:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_query.html">star_query</a></span><span class="op">(</span><span class="va">mrs_db_geo</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="st">"state"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>              measures <span class="op">=</span> <span class="st">"all_deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>              measures <span class="op">=</span> <span class="st">"all_deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_dimension.html">filter_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>, <span class="va">week</span> <span class="op">&lt;=</span> <span class="st">" 3"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="st">"2010"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mrs_db_geo_3</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_query.html">run_query</a></span><span class="op">(</span><span class="va">sq</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">mrs_db_geo_3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "star_database"</span></span></code></pre></div>
<p>The result of running a query is an object of the
<code>star_database</code> class that meets the conditions defined in
the query: Other queries can continue to be defined on this object.</p>
<p>We can see a representation of the tables of the result, as shown
below.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db_geo_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/draw_tables.html">draw_tables</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"mrs_age\" [id = \"mrs_age\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_age<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg_sq<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"mrs_cause\" [id = \"mrs_cause\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_cause<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg_sq<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">year<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">region<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">state<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"mrs_age\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_age_1\"]\n\"mrs_cause\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_cause_1\"]\n\"mrs_age\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_age_2\"]\n\"mrs_cause\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_cause_2\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="exploitation-of-the-result">Exploitation of the result<a class="anchor" aria-label="anchor" href="#exploitation-of-the-result"></a>
</h3>
<p>This section shows an example of how to exploit the result of the
multidimensional query.</p>
<p>The first thing we do is transform it into flat tables.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_single_tibble_list.html">as_single_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ft_age</span> <span class="op">&lt;-</span> <span class="va">ft</span><span class="op">[[</span><span class="st">"mrs_age"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Below are the rows of one of the result tables.</p>
<table style="width:71%;" class="table">
<colgroup>
<col width="9%">
<col width="12%">
<col width="11%">
<col width="18%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">year</th>
<th align="center">region</th>
<th align="center">state</th>
<th align="center">all_deaths</th>
<th align="center">nrow_agg_sq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2010</td>
<td align="center">2</td>
<td align="center">NJ</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">2010</td>
<td align="center">5</td>
<td align="center">VA</td>
<td align="center">50</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">2011</td>
<td align="center">3</td>
<td align="center">IN</td>
<td align="center">65</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">2011</td>
<td align="center">4</td>
<td align="center">MO</td>
<td align="center">115</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">2011</td>
<td align="center">6</td>
<td align="center">AL</td>
<td align="center">165</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2011</td>
<td align="center">9</td>
<td align="center">CA</td>
<td align="center">44</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">2012</td>
<td align="center">8</td>
<td align="center">NM</td>
<td align="center">122</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2013</td>
<td align="center">2</td>
<td align="center">NY</td>
<td align="center">23</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">2013</td>
<td align="center">9</td>
<td align="center">WA</td>
<td align="center">72</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2014</td>
<td align="center">3</td>
<td align="center">OH</td>
<td align="center">327</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">2014</td>
<td align="center">6</td>
<td align="center">TN</td>
<td align="center">70</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2015</td>
<td align="center">5</td>
<td align="center">FL</td>
<td align="center">175</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">2016</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">20</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2016</td>
<td align="center">2</td>
<td align="center">NY</td>
<td align="center">74</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">2016</td>
<td align="center">6</td>
<td align="center">KY</td>
<td align="center">98</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2016</td>
<td align="center">8</td>
<td align="center">CO</td>
<td align="center">58</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">2016</td>
<td align="center">9</td>
<td align="center">CA</td>
<td align="center">14</td>
<td align="center">5</td>
</tr>
</tbody>
</table>
<p>From the results in the form of flat tables, <a href="https://CRAN.R-project.org/package=pivottabler" class="external-link"><code>pivottabler</code></a>
package can be used to present it in the form of pivot tables.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt</span> <span class="op">&lt;-</span> <span class="fu">pivottabler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pivottabler/man/qpvt.html" class="external-link">qpvt</a></span><span class="op">(</span></span>
<span>  <span class="va">ft_age</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"="</span>, <span class="st">"region"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Number of Deaths"</span> <span class="op">=</span> <span class="st">"sum(all_deaths)"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pt</span><span class="op">$</span><span class="fu">renderPivot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-36aa3d2a04d42bbc2145" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"tableCss":".Table {display: table; border-collapse: collapse; }\r\n.ColumnHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px; text-align: center; }\r\n.RowHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px 8px 2px 2px; text-align: left; }\r\n.Cell {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n.OutlineColumnHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px; text-align: center; }\r\n.OutlineRowHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px 8px 2px 2px; text-align: left; }\r\n.OutlineCell {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; background-color: #F8F8F8; font-weight: bold; }\r\n.Total {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n","tableHtml":"<table class=\"Table\">\n  <tr>\n    <th class=\"RowHeader\" colspan=\"2\">&nbsp;<\/th>\n    <th class=\"ColumnHeader\">2010<\/th>\n    <th class=\"ColumnHeader\">2011<\/th>\n    <th class=\"ColumnHeader\">2012<\/th>\n    <th class=\"ColumnHeader\">2013<\/th>\n    <th class=\"ColumnHeader\">2014<\/th>\n    <th class=\"ColumnHeader\">2015<\/th>\n    <th class=\"ColumnHeader\">2016<\/th>\n    <th class=\"ColumnHeader\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\" rowspan=\"9\">Number of Deaths<\/th>\n    <th class=\"RowHeader\">1<\/th>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">20<\/td>\n    <td class=\"Total\">20<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">2<\/th>\n    <td class=\"Cell\">1<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">23<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">74<\/td>\n    <td class=\"Total\">98<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">3<\/th>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">65<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">327<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">392<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">4<\/th>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">115<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">115<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">5<\/th>\n    <td class=\"Cell\">50<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">175<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">225<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">6<\/th>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">165<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">70<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">98<\/td>\n    <td class=\"Total\">333<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">8<\/th>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">122<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">58<\/td>\n    <td class=\"Total\">180<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">9<\/th>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">44<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">72<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">14<\/td>\n    <td class=\"Total\">130<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">Total<\/th>\n    <td class=\"Total\">51<\/td>\n    <td class=\"Total\">389<\/td>\n    <td class=\"Total\">122<\/td>\n    <td class=\"Total\">95<\/td>\n    <td class=\"Total\">397<\/td>\n    <td class=\"Total\">175<\/td>\n    <td class=\"Total\">264<\/td>\n    <td class=\"Total\">1493<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="obtaining-layers-with-geographic-information">Obtaining layers with geographic information<a class="anchor" aria-label="anchor" href="#obtaining-layers-with-geographic-information"></a>
</h2>
<p>If in a <code>star_database</code> object we have attributes to which
geographic information has been associated, we can obtain geographic
information layers that include fact and dimension data.</p>
<p>To include only the data we need, using query operations we can
previously filter the <code>star_database</code> object. Once the
geographic information layer is obtained, it can also be filtered to
select the variables represented.</p>
<p>The following sections show how to obtain a geographic information
layer and the operations that we can perform on it.</p>
<div class="section level3">
<h3 id="get-a-geolayer-object">Get a <code>geolayer</code> object<a class="anchor" aria-label="anchor" href="#get-a-geolayer-object"></a>
</h3>
<p>From a <code>star_database</code> object with some attribute to which
we have associated geographic information (<em>geoattribute</em>), we
can obtain a <code>geolayer</code> object. If there is more than one, we
have to indicate the layer granularity geoattribute.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_state</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_geolayer.html">as_geolayer</a></span><span class="op">(</span>attribute <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>geolayer</code> object is composed of a layer of geographic
information at the level of detail of the geoattribute and another where
the variables of the recorded data are described.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layer_state</span> <span class="op">&lt;-</span> <span class="va">gl_state</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_layer.html">get_layer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">layer_state</span></span>
<span><span class="co">#&gt; Simple feature collection with 15 features and 16 fields</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -124.8485 ymin: 24.39935 xmax: -69.86288 ymax: 49.00242</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 17</span></span></span>
<span><span class="co">#&gt;    state region var_01 var_02 var_03 var_04 var_05 var_06 var_07 var_08 var_09</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AL    6          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    165    165     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> CA    9          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     44     44     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CO    8          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> FL    5          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> IN    3          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     65     65     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> KY    6          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> MA    1          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> MO    4          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    115    116     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> NJ    2           1      1     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> NM    8          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    122    122     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> NY    2          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     23     23     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> OH    3          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    327</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> TN    6          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> VA    5          50     50     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> WA    9          <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     72     72     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: var_10 &lt;int&gt;, var_11 &lt;int&gt;, var_12 &lt;int&gt;, var_13 &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   var_14 &lt;int&gt;, geom &lt;GEOMETRY [°]&gt;</span></span></span>
<span></span>
<span><span class="va">var_state</span> <span class="op">&lt;-</span> <span class="va">gl_state</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_variables.html">get_variables</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">var_state</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 4</span></span></span>
<span><span class="co">#&gt;    variable year  facts     measure   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> var_01   2010  mrs_age   all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> var_02   2010  mrs_cause all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> var_03   2011  mrs_age   all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> var_04   2011  mrs_cause all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> var_05   2012  mrs_age   all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> var_06   2012  mrs_cause all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> var_07   2013  mrs_age   all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> var_08   2013  mrs_cause all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> var_09   2014  mrs_age   all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> var_10   2014  mrs_cause all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> var_11   2015  mrs_age   all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> var_12   2015  mrs_cause all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> var_13   2016  mrs_age   all_deaths</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> var_14   2016  mrs_cause all_deaths</span></span></code></pre></div>
<p>We can generate the geographic information layer so that it contains
only the objects for which we have additional information, as we have
done.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">layer_state</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">layer_state</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="va">layer_state</span><span class="op">$</span><span class="va">state</span>,</span>
<span>  pos <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="v70-star_query_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>We can also generate it for all objects in the original layer, even
if they do not contain information.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layer_state_all</span> <span class="op">&lt;-</span> <span class="va">gl_state</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_layer.html">get_layer</a></span><span class="op">(</span>keep_all_variables_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_shift_longitude.html" class="external-link">st_shift_longitude</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">layer_state_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="v70-star_query_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="operations-on-variables">Operations on variables<a class="anchor" aria-label="anchor" href="#operations-on-variables"></a>
</h3>
<p>For the variables, in addition to being able to obtain them in
<code>tibble</code> format, we can consult for those whose name we
indicate or for all of their meaning, as shown below.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_state</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_variable_description.html">get_variable_description</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var_01"</span>, <span class="st">"var_10"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                 var_01 </span></span>
<span><span class="co">#&gt;   "year = 2010, facts = mrs_age, measure = all_deaths" </span></span>
<span><span class="co">#&gt;                                                 var_10 </span></span>
<span><span class="co">#&gt; "year = 2014, facts = mrs_cause, measure = all_deaths"</span></span>
<span></span>
<span><span class="va">vd</span> <span class="op">&lt;-</span> <span class="va">gl_state</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_variable_description.html">get_variable_description</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">vd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var_01"</span>, <span class="st">"var_10"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                                                 var_01 </span></span>
<span><span class="co">#&gt;   "year = 2010, facts = mrs_age, measure = all_deaths" </span></span>
<span><span class="co">#&gt;                                                 var_10 </span></span>
<span><span class="co">#&gt; "year = 2014, facts = mrs_cause, measure = all_deaths"</span></span></code></pre></div>
<p>The variables are a <code>tibble</code> and we can select them using
the <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> function.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_state_2</span> <span class="op">&lt;-</span> <span class="va">var_state</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="st">'2016'</span><span class="op">)</span></span></code></pre></div>
<p>Once the variables we need have been filtered, we can filter the
geographic information layer so that it will only contain these
variables.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_state_2</span> <span class="op">&lt;-</span> <span class="va">gl_state</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_variables.html">set_variables</a></span><span class="op">(</span><span class="va">var_state_2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">layer_state_2</span> <span class="op">&lt;-</span> <span class="va">gl_state_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_layer.html">get_layer</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">layer_state_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">layer_state_2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="va">layer_state_2</span><span class="op">$</span><span class="va">state</span>,</span>
<span>  pos <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="v70-star_query_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="data-representation">Data representation<a class="anchor" aria-label="anchor" href="#data-representation"></a>
</h3>
<p>For example, for each state we are going to represent the percentage
of pneumonia and influenza deaths registered, starting in 2010. First of
all, we must define the query.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sq_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_query.html">star_query</a></span><span class="op">(</span><span class="va">mrs_db_geo</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>              measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pneumonia_and_influenza_deaths"</span>, <span class="st">"all_deaths"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_dimension.html">filter_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="st">"2010"</span><span class="op">)</span></span></code></pre></div>
<p>We run the query and get a <code>star_database</code> object as a
result.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db_geo_3</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_query.html">run_query</a></span><span class="op">(</span><span class="va">sq_2</span><span class="op">)</span></span></code></pre></div>
<p>We obtain a <code>geolayer</code> object.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_state_3</span> <span class="op">&lt;-</span> <span class="va">mrs_db_geo_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_geolayer.html">as_geolayer</a></span><span class="op">(</span>attribute <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we represent it.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_state_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_variable_description.html">get_variable_description</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                      var_1 </span></span>
<span><span class="co">#&gt;                     "measure = all_deaths" </span></span>
<span><span class="co">#&gt;                                      var_2 </span></span>
<span><span class="co">#&gt; "measure = pneumonia_and_influenza_deaths"</span></span>
<span></span>
<span><span class="va">layer</span> <span class="op">&lt;-</span> <span class="va">gl_state_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_layer.html">get_layer</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">layer</span><span class="op">$</span><span class="va">tpc_deaths</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">layer</span><span class="op">$</span><span class="va">var_2</span> <span class="op">/</span> <span class="va">layer</span><span class="op">$</span><span class="va">var_1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">layer</span><span class="op">[</span>, <span class="st">"tpc_deaths"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"% pneumonia and influenza"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v70-star_query_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>To maintain the definition of the new variable in the
<code>geolayer</code> object, we can define that this is the new
geographic information layer of it.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_state_3</span> <span class="op">&lt;-</span> <span class="va">gl_state_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_layer.html">set_layer</a></span><span class="op">(</span><span class="va">layer</span><span class="op">)</span></span></code></pre></div>
<p>If we want to treat the geographic information layer with another
tool, we can export it along with the variable definition table in
<em>GeoPackage</em> format.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">gl_state_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_GeoPackage.html">as_GeoPackage</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; Driver: GPKG </span></span>
<span><span class="co">#&gt; Available layers:</span></span>
<span><span class="co">#&gt;   layer_name geometry_type features fields crs_name</span></span>
<span><span class="co">#&gt; 1   geolayer                     39      4   WGS 84</span></span>
<span><span class="co">#&gt; 2  variables            NA        2      2     &lt;NA&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>This document presents some of the querying possibilities that offers
the <code>rolap</code> package. The queries are formulated on an object
of class <code>star_database</code> and the result is another object of
the same class on which additional queries can be made.</p>
<p>Queries can be formulated about a star or set of stars or
constellation.</p>
<p>We can define attributes that have associated geographic information.
If any of these geographic attributes are included in the result of a
query, we obtain a geographic information layer in which the result of
the query is defined in the form of variables that can be filtered and
queried.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>

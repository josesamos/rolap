<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rolap">
<title>Star databases and RDBMS through the dm and rolap packages • rolap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Star databases and RDBMS through the dm and rolap packages">
<meta property="og:description" content="rolap">
<meta property="og:image" content="https://josesamos.github.io/rolap/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rolap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/rolap.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v05-flat-table-op.html">Obtaining and transforming flat tables</a>
    <a class="dropdown-item" href="../articles/v10-rpd.html">Definition of role-playing and role dimensions</a>
    <a class="dropdown-item" href="../articles/v20-rdbms-dm.html">Star databases and RDBMS through the dm and rolap packages</a>
    <a class="dropdown-item" href="../articles/v30-dim-instances.html">Integration of dimension instances</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josesamos/rolap/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="v20-rdbms-dm_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="v20-rdbms-dm_files/viz-1.8.2/viz.js"></script><link href="v20-rdbms-dm_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="v20-rdbms-dm_files/grViz-binding-1.0.10/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Star databases and RDBMS through the dm and rolap packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/rolap/blob/HEAD/vignettes/v20-rdbms-dm.Rmd" class="external-link"><code>vignettes/v20-rdbms-dm.Rmd</code></a></small>
      <div class="d-none name"><code>v20-rdbms-dm.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The main objective of this document is to show how to access
transactional data in RDBMS (<em>Relational Database Management
Systems</em>) and store the star database generated from it in another
relational database. Access to the databases is done through the <a href="https://cran.r-project.org/package=dm" class="external-link"><code>dm</code></a>
package. The transformations are carried out using the
<code>rolap</code> package.</p>
<p>Additionally, a multidimensional design case is solved using star
databases with two granularities.</p>
<p>First, the initial transactional data is presented. The following
shows the implementation of the star databases. Finally, it ends with
the conclusions.</p>
</div>
<div class="section level2">
<h2 id="transactional-data">Transactional data<a class="anchor" aria-label="anchor" href="#transactional-data"></a>
</h2>
<p>We will build on a dataset with transactional data from Czech debit
card company specialising on payments at gas stations called <a href="https://relational.fit.cvut.cz/dataset/CCS" class="external-link">CCS</a>, publicly
available in a RDBMS.</p>
<p>First, we make a connection by following the instructions they offer,
as shown below<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;In the R code that is included, although with the use of
&lt;code&gt;library&lt;/code&gt; it is not necessary, for each function it is
indicated by the prefix the package where it is defined.&lt;/p&gt;"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmariadb.r-dbi.org" class="external-link">RMariaDB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ccs_db</span> <span class="op">&lt;-</span> <span class="fu">RMariaDB</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span></span>
<span>  <span class="fu">RMariaDB</span><span class="fu">::</span><span class="fu"><a href="https://rmariadb.r-dbi.org/reference/dbConnect-MariaDBDriver-method.html" class="external-link">MariaDB</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"guest"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"relational"</span>,</span>
<span>  dbname <span class="op">=</span> <span class="st">"ccs"</span>,</span>
<span>  host <span class="op">=</span> <span class="st">"relational.fit.cvut.cz"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, from the connection, we can obtain a <code>dm</code> object,
taking the definition of the keys from the database.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dm.cynkra.com/" class="external-link">dm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ccs_dm</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_from_con.html" class="external-link">dm_from_con</a></span><span class="op">(</span><span class="va">ccs_db</span>, learn_keys <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Using the following function we can display the database tables with
all their fields.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ccs_dm</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f181e86be5c141b2cfa1" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-f181e86be5c141b2cfa1">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"customers\" [id = \"customers\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">customers<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"CustomerID\"><U>CustomerID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Segment<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Currency<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"gasstations\" [id = \"gasstations\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">gasstations<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"GasStationID\"><U>GasStationID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">ChainID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Country<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Segment<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"products\" [id = \"products\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">products<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"ProductID\"><U>ProductID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Description<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"transactions\" [id = \"transactions\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">transactions<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Time<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"CustomerID\">CustomerID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">CardID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"GasStationID\">GasStationID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"ProductID\">ProductID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Amount<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Price<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"transactions_1k\" [id = \"transactions_1k\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">transactions_1k<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"TransactionID\"><U>TransactionID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Time<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">CustomerID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">CardID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">GasStationID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">ProductID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Amount<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Price<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"yearmonth\" [id = \"yearmonth\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">yearmonth<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"CustomerID\">CustomerID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Consumption<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"CustomerID, Date\"><U>CustomerID, Date<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"transactions\":\"CustomerID\"->\"customers\":\"CustomerID\" [id=\"transactions_1\"]\n\"yearmonth\":\"CustomerID\"->\"customers\":\"CustomerID\" [id=\"yearmonth_1\"]\n\"transactions\":\"GasStationID\"->\"gasstations\":\"GasStationID\" [id=\"transactions_2\"]\n\"transactions\":\"ProductID\"->\"products\":\"ProductID\" [id=\"transactions_3\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>We can access tables as if they were part of a list. If we access the
<em>transactions</em> table we can see that it has no data, the data is
in the <em>transactions_1k</em> table hat is not related to the other
tables.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ccs_dm</span><span class="op">$</span><span class="va">transactions</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;`ccs`.`transactions`&gt; [0 x 8]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: mysql  [guest@relational.fit.cvut.cz:NA/ccs]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 variables: Date &lt;date&gt;, Time &lt;time&gt;, CustomerID &lt;int&gt;, CardID &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   GasStationID &lt;int&gt;, ProductID &lt;int&gt;, Amount &lt;int&gt;, Price &lt;dbl&gt;</span></span></span></code></pre></div>
<p>On the other hand, the <em>yearmonth</em> table contains historical
customer data, which we will not use in this example.</p>
<p>Therefore, what we do is generate a new <code>dm</code> object by
selecting the tables that we are going to use and relating table
<em>transactions_1k</em> to the rest of the tables. These operations are
performed below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ccs_sel_dm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ccs_dm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'transactions_1k'</span>, <span class="st">'customers'</span>, <span class="st">'gasstations'</span>, <span class="st">'products'</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_add_fk.html" class="external-link">dm_add_fk</a></span><span class="op">(</span><span class="va">transactions_1k</span>, <span class="va">CustomerID</span>, <span class="va">customers</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_add_fk.html" class="external-link">dm_add_fk</a></span><span class="op">(</span><span class="va">transactions_1k</span>, <span class="va">GasStationID</span>, <span class="va">gasstations</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_add_fk.html" class="external-link">dm_add_fk</a></span><span class="op">(</span><span class="va">transactions_1k</span>, <span class="va">ProductID</span>, <span class="va">products</span><span class="op">)</span></span></code></pre></div>
<p>The resulting database schema is shown below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ccs_sel_dm</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c6a706a7b5b303d7c76c" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-c6a706a7b5b303d7c76c">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"customers\" [id = \"customers\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">customers<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"CustomerID\"><U>CustomerID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Segment<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Currency<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"gasstations\" [id = \"gasstations\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">gasstations<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"GasStationID\"><U>GasStationID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">ChainID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Country<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Segment<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"products\" [id = \"products\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">products<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"ProductID\"><U>ProductID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Description<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"transactions_1k\" [id = \"transactions_1k\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">transactions_1k<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"TransactionID\"><U>TransactionID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Time<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"CustomerID\">CustomerID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">CardID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"GasStationID\">GasStationID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"ProductID\">ProductID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Amount<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">Price<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"transactions_1k\":\"CustomerID\"->\"customers\":\"CustomerID\" [id=\"transactions_1k_1\"]\n\"transactions_1k\":\"GasStationID\"->\"gasstations\":\"GasStationID\" [id=\"transactions_1k_2\"]\n\"transactions_1k\":\"ProductID\"->\"products\":\"ProductID\" [id=\"transactions_1k_3\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>The starting point of the <code>rolap</code> package to define the
transformations to obtain a star database is a flat table. To generate a
flat table in a <code>tibble</code> from the database tables we can use
the functions offered by the <code>dm</code> package, as shown
below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transactions_ft</span> <span class="op">&lt;-</span> <span class="va">ccs_sel_dm</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_flatten_to_tbl.html" class="external-link">dm_flatten_to_tbl</a></span><span class="op">(</span><span class="va">transactions_1k</span>, .recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; c("TransactionID", "Date", "Time", "CustomerID", "CardID", "GasStationID", </span></span>
<span><span class="co">#&gt; "ProductID", "Amount", "Price", "Segment.customers", "Currency", </span></span>
<span><span class="co">#&gt; "ChainID", "Country", "Segment.gasstations", "Description")</span></span></code></pre></div>
<p>With this we already have in the <code>transactions_ft</code>
variable the flat table with the transactional data that we are going to
use. In the list of fields of this table, we can see that the fields
with the same name that were in several tables are now postfixed with
the name of the table they came from (<em>Segment.customers</em> and
<em>Segment.gasstations</em>).</p>
<p>Since we already have the result we need, we can disconnect from the
database.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">ccs_db</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="star-databases">Star databases<a class="anchor" aria-label="anchor" href="#star-databases"></a>
</h2>
<p>From the data in the flat table (variable
<code>transactions_ft</code>), we are going to carry out a
multidimensional design.</p>
<p>We will start by exploring part of the data to get to know it
better.</p>
<div class="section level3">
<h3 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h3>
<p>The <em>transactions_1k</em> table has the <em>TransactionID</em>
field as its primary key. We check that this field is a surrogate key,
autonumber, as shown below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">$</span><span class="va">TransactionID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">$</span><span class="va">TransactionID</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">$</span><span class="va">TransactionID</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<p>As would be expected, a transaction would correspond to the payment
of a customer, by means of a card, for one or several products at a gas
station and at a specific moment.</p>
<p>We can verify that this is true by obtaining the number of distinct
instances for the combinations of attributes of interest.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Time"</span>, <span class="st">"CustomerID"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 919</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Time"</span>, <span class="st">"CardID"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 921</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">transactions_ft</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Time"</span>, <span class="st">"CardID"</span>, <span class="st">"ProductID"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<p>In view of these results, we deduce that a customer has paid at the
same time with more than one card: This has been possible because the
time is given in minutes. By adding the product to the combination of
attributes that includes card, it is observed that all the rows of the
table are obtained.</p>
<p>In view of this, we consider that:</p>
<ul>
<li>A transaction is identified by a card and an instant of time in
which a payment is made.</li>
<li>A transaction can include several products, each row is a
transaction line that is defined by a transaction and a product.</li>
</ul>
<p>There is nothing remarkable in the rest of the data.</p>
</div>
<div class="section level3">
<h3 id="design-with-the-finest-possible-granularity">Design with the finest possible granularity<a class="anchor" aria-label="anchor" href="#design-with-the-finest-possible-granularity"></a>
</h3>
<p>First, we are going to make a design with the finest granularity.</p>
<p>We are going to add an <em>Hour</em> field obtained from the
<em>Time</em> field. We also add a processing date, assuming we know
that transactions are processed 48 hours after they occur.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transactions_ft</span> <span class="op">&lt;-</span> <span class="va">transactions_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%H"</span><span class="op">)</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`Processing Date` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="star-schema">Star schema<a class="anchor" aria-label="anchor" href="#star-schema"></a>
</h4>
<p>We define the star schema by distributing the flat table attributes
into facts and dimensions.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://josesamos.github.io/rolap/">rolap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">s_finest</span> <span class="op">&lt;-</span> <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Transaction Line"</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amount"</span>, <span class="st">"Price"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Transaction"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Time"</span>, <span class="st">"CardID"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Who"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CardID"</span>, <span class="st">"CustomerID"</span>, <span class="st">"Segment.customers"</span>,</span>
<span>                   <span class="st">"Currency"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Where"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GasStationID"</span>, <span class="st">"ChainID"</span>, <span class="st">"Country"</span>,</span>
<span>                   <span class="st">"Segment.gasstations"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When Moment"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When Processed"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Processing Date"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"What"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Description"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The most remarkable thing about the definition is that the facts
correspond to a transaction line, each line corresponding to a product
in the transaction. On the other hand, each transaction is identified by
the attributes <em>Date</em>, <em>Time</em> and <em>CardID</em>. Since
these concepts are already represented in other dimensions, the
surrogate key (foreign key in the facts) would be enough to represent
the transaction, so <em>Transaction</em> would be a
<strong><em>degenerate dimension</em></strong> (the dimension table is
not needed, the foreign key in the facts is enough).</p>
<p>Subsequently, the dimensions could be enriched with other attributes
available in the transactional system. In this case, we are going to
leave them as they are.</p>
</div>
<div class="section level4">
<h4 id="star-database">Star database<a class="anchor" aria-label="anchor" href="#star-database"></a>
</h4>
<p>From the star schema and the flat table, we obtain a star database
with the tables of the dimensions and facts.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_finest</span> <span class="op">&lt;-</span> <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/star_database.html">star_database</a></span><span class="op">(</span><span class="va">s_finest</span>, <span class="va">transactions_ft</span><span class="op">)</span></span></code></pre></div>
<p>We can transform the database by renaming the measures of the facts
and/or the attributes of the dimensions and also, if we are going to
work in a RDBMS, transforming them to snake case style.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_finest</span> <span class="op">&lt;-</span> <span class="va">db_finest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/set_attribute_names.html">set_attribute_names</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"who"</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"card"</span>,</span>
<span>      <span class="st">"customer"</span>,</span>
<span>      <span class="st">"segment"</span>,</span>
<span>      <span class="st">"currency"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/set_attribute_names.html">set_attribute_names</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"gas_station"</span>,</span>
<span>      <span class="st">"chain"</span>,</span>
<span>      <span class="st">"country"</span>,</span>
<span>      <span class="st">"segment"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/set_attribute_names.html">set_attribute_names</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"what"</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"product"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="presentation-of-the-result">Presentation of the result<a class="anchor" aria-label="anchor" href="#presentation-of-the-result"></a>
</h4>
<p>For easier access to the result tables, we are going to transform
them into a list of <code>tibble</code> objects and show their names and
number of instances.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_tl</span> <span class="op">&lt;-</span> <span class="va">db_finest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"name: %s, %d rows\n"</span>, <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; name: transaction, 921 rows</span></span>
<span><span class="co">#&gt; name: who, 902 rows</span></span>
<span><span class="co">#&gt; name: where, 437 rows</span></span>
<span><span class="co">#&gt; name: when, 61 rows</span></span>
<span><span class="co">#&gt; name: when_moment, 599 rows</span></span>
<span><span class="co">#&gt; name: when_processed, 61 rows</span></span>
<span><span class="co">#&gt; name: what, 27 rows</span></span>
<span><span class="co">#&gt; name: transaction_line, 1000 rows</span></span></code></pre></div>
<p>To represent the result graphically, we export the star database in
the form of a <code>dm</code> object. In addition, we select the tables
of the model: All except the table of the degenerate dimension.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_dm</span> <span class="op">&lt;-</span> <span class="va">db_finest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="va">db_finest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/get_table_names.html">get_table_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Degenerate dimension</span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">tables</span>, <span class="st">'transaction'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_finest_dm</span> <span class="op">&lt;-</span> <span class="va">db_dm</span><span class="op">[</span><span class="va">tables</span><span class="op">]</span></span></code></pre></div>
<p>Below is the database schema.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_finest_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-02334c1ebf547a29f26d" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-02334c1ebf547a29f26d">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"transaction_line\" [id = \"transaction_line\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">transaction_line<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">transaction_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_key\">who_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_moment_key\">when_moment_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_processed_key\">when_processed_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"what_key\">what_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">amount<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">price<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"what\" [id = \"what\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">what<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"what_key\"><U>what_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">product<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when_moment\" [id = \"when_moment\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when_moment<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_moment_key\"><U>when_moment_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">time<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when_processed\" [id = \"when_processed\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when_processed<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_processed_key\"><U>when_processed_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">processing_date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">gas_station<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">chain<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">country<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who\" [id = \"who\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_key\"><U>who_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">card<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">customer<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">currency<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"transaction_line\":\"what_key\"->\"what\":\"what_key\" [id=\"transaction_line_1\"]\n\"transaction_line\":\"when_key\"->\"when\":\"when_key\" [id=\"transaction_line_2\"]\n\"transaction_line\":\"when_moment_key\"->\"when_moment\":\"when_moment_key\" [id=\"transaction_line_3\"]\n\"transaction_line\":\"when_processed_key\"->\"when_processed\":\"when_processed_key\" [id=\"transaction_line_4\"]\n\"transaction_line\":\"where_key\"->\"where\":\"where_key\" [id=\"transaction_line_5\"]\n\"transaction_line\":\"who_key\"->\"who\":\"who_key\" [id=\"transaction_line_6\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>It can be seen that a new measure has been added to the fact table
(<em>nrow_agg</em>), this measure indicates for each row the number of
rows in the original table from which it was obtained. In the definition
of the facts you can indicate a specific name for it. In this case, each
row corresponds to a row in the original table, therefore, all the
values must be 1, as can be verified below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">[[</span><span class="st">'transaction_line'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nrow_agg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">[[</span><span class="st">'transaction_line'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nrow_agg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="definition-of-role-playing-and-role-dimensions">Definition of role-playing and role dimensions<a class="anchor" aria-label="anchor" href="#definition-of-role-playing-and-role-dimensions"></a>
</h4>
<p>In the star database, we can define that any one of the dimensions is
the role-playing dimension and the other dimensions are various roles of
that dimension, the only requirement is that all dimensions must have
the same number of attributes. More details can be found in the vignette
titled <em>Definition of Role-Playing and Role Dimensions</em>,
<code><a href="../articles/v10-rpd.html">vignette("v10-rpd")</a></code>.</p>
<p>For the case we are solving, the definition is shown below.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_finest</span> <span class="op">&lt;-</span> <span class="va">db_finest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/role_playing_dimension.html">role_playing_dimension</a></span><span class="op">(</span></span>
<span>    rpd <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>    roles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"when_processed"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The result can be seen in the instances of the star database tables,
below.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_tl</span> <span class="op">&lt;-</span> <span class="va">db_finest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"name: %s, %d rows\n"</span>, <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; name: transaction, 921 rows</span></span>
<span><span class="co">#&gt; name: who, 902 rows</span></span>
<span><span class="co">#&gt; name: where, 437 rows</span></span>
<span><span class="co">#&gt; name: when, 106 rows</span></span>
<span><span class="co">#&gt; name: when_moment, 599 rows</span></span>
<span><span class="co">#&gt; name: when_processed, 106 rows</span></span>
<span><span class="co">#&gt; name: what, 27 rows</span></span>
<span><span class="co">#&gt; name: transaction_line, 1000 rows</span></span></code></pre></div>
<p>We can see that the tables associated with the <em>when</em>
dimension (with date and hour) contain the same number of instances, but
a larger number than before since they include all the different
instances of the two tables.</p>
</div>
<div class="section level4">
<h4 id="store-tables-in-a-relational-database">Store tables in a relational database<a class="anchor" aria-label="anchor" href="#store-tables-in-a-relational-database"></a>
</h4>
<p>Once we have the star database tables in a <code>dm</code> object,
exporting them to any RDBMS is immediate. In the example below, a local
<em>SQLite</em> database is used. <code>dm</code> works with any RDBMS
supported by <code>DBI</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_db</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_db_finest_dm</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/copy_dm_to.html" class="external-link">copy_dm_to</a></span><span class="op">(</span><span class="va">my_db</span>, <span class="va">db_finest_dm</span><span class="op">)</span></span>
<span><span class="va">my_db_finest_dm</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">──</span> <span style="color: #00BB00;">Table source</span> <span style="color: #00BB00;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; src:  sqlite 3.41.2 []</span></span>
<span><span class="co">#&gt; <span style="color: #FFAFFF;">──</span> <span style="color: #FFAFFF;">Metadata</span> <span style="color: #FFAFFF;">────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Tables: `transaction_line`, `what`, `when`, `when_moment`, `when_processed`, … (7 total)</span></span>
<span><span class="co">#&gt; Columns: 31</span></span>
<span><span class="co">#&gt; Primary keys: 6</span></span>
<span><span class="co">#&gt; Foreign keys: 6</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">my_db</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="design-with-a-summary-of-the-data">Design with a summary of the data<a class="anchor" aria-label="anchor" href="#design-with-a-summary-of-the-data"></a>
</h3>
<p>Next we are going to perform a multidimensional design with a coarser
granularity. To have somewhat different dates from the previous example,
we are going to define a new date, assuming we know that transactions
are paid 24 hours after they occur.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transactions_ft</span> <span class="op">&lt;-</span> <span class="va">transactions_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`Payment Date` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="star-schema-1">Star schema<a class="anchor" aria-label="anchor" href="#star-schema-1"></a>
</h4>
<p>To design the star schema, for each dimension we exclusively select
the attributes that we consider necessary.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_summary</span> <span class="op">&lt;-</span> <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Transaction Summary"</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amount"</span>, <span class="st">"Price"</span><span class="op">)</span>,</span>
<span>    nrow_agg <span class="op">=</span> <span class="st">"Transactions"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Who Segment"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Segment.customers"</span>,</span>
<span>                   <span class="st">"Currency"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Where Chain"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ChainID"</span>, <span class="st">"Country"</span>,</span>
<span>                   <span class="st">"Segment.gasstations"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When Paid"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Payment Date"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"What"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Description"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We have assumed that we are not interested in individual transactions
but in a summary of them; neither the particular data of the clients,
but only the associated segment and currency. We are not interested in
gas stations either, but only the chain to which they belong and the
rest of the dimension attributes. Finally, in this case, the dimension
with the data of the processing date has been interpreted as payment
date.</p>
<p>Each measure can be associated with a specific aggregation function,
by default it is the sum which, in this case, can be considered adequate
since adding to group the data the meaning of the measures is preserved
(understanding <em>Price</em> as the total amount of the sale
operation). Otherwise, it is advisable to define measures obtained from
those available so that this principle is fulfilled.</p>
<p>Finally, indicate that this time a specific name has been assigned to
the measure of the number of rows added: <em>Transactions</em>.</p>
</div>
<div class="section level4">
<h4 id="star-database-1">Star database<a class="anchor" aria-label="anchor" href="#star-database-1"></a>
</h4>
<p>As before, from the star schema and the flat table, we obtain a star
database with the tables of the dimensions and facts. We also transform
the names of dimension attributes and define the role-playing and role
dimensions.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_summary</span> <span class="op">&lt;-</span> <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/star_database.html">star_database</a></span><span class="op">(</span><span class="va">s_summary</span>, <span class="va">transactions_ft</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/set_attribute_names.html">set_attribute_names</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"who_segment"</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"segment"</span>,</span>
<span>      <span class="st">"currency"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/set_attribute_names.html">set_attribute_names</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"where_chain"</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"chain"</span>,</span>
<span>      <span class="st">"country"</span>,</span>
<span>      <span class="st">"segment"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/set_attribute_names.html">set_attribute_names</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"what"</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"product"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/role_playing_dimension.html">role_playing_dimension</a></span><span class="op">(</span></span>
<span>    rpd <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>    roles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"when_paid"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Finally, we present the result obtained showing the names and number
of rows of the tables. We check that the number of rows added matches
the total number of rows in the initial flat table.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_tl</span> <span class="op">&lt;-</span> <span class="va">db_summary</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"name: %s, %d rows\n"</span>, <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; name: who_segment, 6 rows</span></span>
<span><span class="co">#&gt; name: where_chain, 33 rows</span></span>
<span><span class="co">#&gt; name: when, 84 rows</span></span>
<span><span class="co">#&gt; name: when_paid, 84 rows</span></span>
<span><span class="co">#&gt; name: what, 27 rows</span></span>
<span><span class="co">#&gt; name: transaction_summary, 777 rows</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">[[</span><span class="st">'transaction_summary'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">transactions</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<p>If we compare it with the previous example, we verify that there are
fewer instances in the <em>when</em> dimension tables because in this
case the difference between dates was 24 hours (before it was 48
hours).</p>
<p>We also show its graphic representation.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_summary_dm</span> <span class="op">&lt;-</span> <span class="va">db_summary</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_summary_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5eb656bbb6219582364a" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-5eb656bbb6219582364a">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"transaction_summary\" [id = \"transaction_summary\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">transaction_summary<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_segment_key\">who_segment_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_chain_key\">where_chain_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_paid_key\">when_paid_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"what_key\">what_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">amount<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">price<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">transactions<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"what\" [id = \"what\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">what<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"what_key\"><U>what_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">product<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when_paid\" [id = \"when_paid\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when_paid<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_paid_key\"><U>when_paid_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">payment_date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where_chain\" [id = \"where_chain\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where_chain<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_chain_key\"><U>where_chain_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">chain<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">country<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who_segment\" [id = \"who_segment\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who_segment<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_segment_key\"><U>who_segment_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">currency<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"transaction_summary\":\"who_segment_key\"->\"who_segment\":\"who_segment_key\" [id=\"transaction_summary_1\"]\n\"transaction_summary\":\"where_chain_key\"->\"where_chain\":\"where_chain_key\" [id=\"transaction_summary_2\"]\n\"transaction_summary\":\"when_key\"->\"when\":\"when_key\" [id=\"transaction_summary_3\"]\n\"transaction_summary\":\"when_paid_key\"->\"when_paid\":\"when_paid_key\" [id=\"transaction_summary_4\"]\n\"transaction_summary\":\"what_key\"->\"what\":\"what_key\" [id=\"transaction_summary_5\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>Tables can be stored directly in any RDBMS, just as we have done
before.</p>
</div>
</div>
<div class="section level3">
<h3 id="constellation">Constellation<a class="anchor" aria-label="anchor" href="#constellation"></a>
</h3>
<p>We can work with the star databases separately or in an integrated
way by defining a constellation from them. On the constellation we can
carry out the same operations that we perform on a star database.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/constellation.html">constellation</a></span><span class="op">(</span><span class="st">"CSS"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">db_finest</span>, <span class="va">db_summary</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_tl</span> <span class="op">&lt;-</span> <span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"name: %s, %d rows\n"</span>, <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">db_tl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; name: transaction, 921 rows</span></span>
<span><span class="co">#&gt; name: what, 27 rows</span></span>
<span><span class="co">#&gt; name: when, 107 rows</span></span>
<span><span class="co">#&gt; name: when_moment, 599 rows</span></span>
<span><span class="co">#&gt; name: when_paid, 107 rows</span></span>
<span><span class="co">#&gt; name: when_processed, 107 rows</span></span>
<span><span class="co">#&gt; name: where, 437 rows</span></span>
<span><span class="co">#&gt; name: where_chain, 33 rows</span></span>
<span><span class="co">#&gt; name: who, 902 rows</span></span>
<span><span class="co">#&gt; name: who_segment, 6 rows</span></span>
<span><span class="co">#&gt; name: transaction_line, 1000 rows</span></span>
<span><span class="co">#&gt; name: transaction_summary, 777 rows</span></span>
<span></span>
<span><span class="va">ct_dm_all</span> <span class="op">&lt;-</span> <span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/get_table_names.html">get_table_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Degenerate dimension</span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">tables</span>, <span class="st">'transaction'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ct_dm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ct_dm_all</span><span class="op">[</span><span class="va">tables</span><span class="op">]</span></span>
<span></span>
<span><span class="va">my_db</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_ct_dm</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/copy_dm_to.html" class="external-link">copy_dm_to</a></span><span class="op">(</span><span class="va">my_db</span>, <span class="va">ct_dm</span><span class="op">)</span></span>
<span><span class="va">my_ct_dm</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">──</span> <span style="color: #00BB00;">Table source</span> <span style="color: #00BB00;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; src:  sqlite 3.41.2 []</span></span>
<span><span class="co">#&gt; <span style="color: #FFAFFF;">──</span> <span style="color: #FFAFFF;">Metadata</span> <span style="color: #FFAFFF;">────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Tables: `transaction_line`, `transaction_summary`, `what`, `when`, `when_moment`, … (11 total)</span></span>
<span><span class="co">#&gt; Columns: 49</span></span>
<span><span class="co">#&gt; Primary keys: 9</span></span>
<span><span class="co">#&gt; Foreign keys: 11</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">my_db</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ct_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-fb47851b73468eb674b8" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-fb47851b73468eb674b8">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"transaction_line\" [id = \"transaction_line\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">transaction_line<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">transaction_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_key\">who_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_moment_key\">when_moment_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_processed_key\">when_processed_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"what_key\">what_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">amount<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">price<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"transaction_summary\" [id = \"transaction_summary\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">transaction_summary<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_segment_key\">who_segment_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_chain_key\">where_chain_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_paid_key\">when_paid_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"what_key\">what_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">amount<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">price<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">transactions<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"what\" [id = \"what\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">what<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"what_key\"><U>what_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">product<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when_moment\" [id = \"when_moment\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when_moment<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_moment_key\"><U>when_moment_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">time<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when_paid\" [id = \"when_paid\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when_paid<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_paid_key\"><U>when_paid_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">payment_date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when_processed\" [id = \"when_processed\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when_processed<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_processed_key\"><U>when_processed_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">processing_date<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">hour<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">gas_station<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">chain<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">country<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where_chain\" [id = \"where_chain\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where_chain<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_chain_key\"><U>where_chain_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">chain<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">country<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who\" [id = \"who\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_key\"><U>who_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">card<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">customer<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">currency<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who_segment\" [id = \"who_segment\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who_segment<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_segment_key\"><U>who_segment_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">segment<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">currency<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"transaction_line\":\"what_key\"->\"what\":\"what_key\" [id=\"transaction_line_1\"]\n\"transaction_summary\":\"what_key\"->\"what\":\"what_key\" [id=\"transaction_summary_1\"]\n\"transaction_line\":\"when_key\"->\"when\":\"when_key\" [id=\"transaction_line_2\"]\n\"transaction_summary\":\"when_key\"->\"when\":\"when_key\" [id=\"transaction_summary_2\"]\n\"transaction_line\":\"when_moment_key\"->\"when_moment\":\"when_moment_key\" [id=\"transaction_line_3\"]\n\"transaction_summary\":\"when_paid_key\"->\"when_paid\":\"when_paid_key\" [id=\"transaction_summary_3\"]\n\"transaction_line\":\"when_processed_key\"->\"when_processed\":\"when_processed_key\" [id=\"transaction_line_4\"]\n\"transaction_line\":\"where_key\"->\"where\":\"where_key\" [id=\"transaction_line_5\"]\n\"transaction_summary\":\"where_chain_key\"->\"where_chain\":\"where_chain_key\" [id=\"transaction_summary_4\"]\n\"transaction_line\":\"who_key\"->\"who\":\"who_key\" [id=\"transaction_line_6\"]\n\"transaction_summary\":\"who_segment_key\"->\"who_segment\":\"who_segment_key\" [id=\"transaction_summary_5\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>If we look at the <em>when</em> dimension tables (with date and
hour), it can be seen that they all have the same number of instances:
as there was a table in common between both star databases, a conformed
table has been generated from them and the information about
role-playing and role dimensions has been automatically updated with the
new situation for the joint schema, as shown below .</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rolap</span><span class="fu">::</span><span class="fu"><a href="../reference/get_role_playing_dimension_names.html">get_role_playing_dimension_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $rpd_1</span></span>
<span><span class="co">#&gt; [1] "when"           "when_paid"      "when_processed"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>In this document we have started from transactional data in a RDBMS
and, through the <code>dm</code> and <code>rolap</code> packages, we
have obtained two star databases and/or a constellation also in RDBMS.
The <code>dm</code> package facilitates access to the RDBMS, while the
<code>rolap</code> package supports the definition of the necessary
transformations in this context.</p>
<p>The initial data schema is very close to a star schema although, as
explained in the design section, it is conceptually different
(particularly the concepts of transaction and transaction line). The
simple structure of this schema has only facilitated the process of
obtaining the starting flat table to work with the <code>rolap</code>
package.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

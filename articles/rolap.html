<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Basics and getting started with the `rolap` package • rolap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basics and getting started with the `rolap` package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rolap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/rolap.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v05-flat-table-op.html">Obtaining and transforming flat tables</a></li>
    <li><a class="dropdown-item" href="../articles/v10-rpd.html">Definition of role-playing and role dimensions</a></li>
    <li><a class="dropdown-item" href="../articles/v40-refresh.html">Incremental refresh of star databases</a></li>
    <li><a class="dropdown-item" href="../articles/v50-deploy.html">Deployment of star databases with incremental refresh</a></li>
    <li><a class="dropdown-item" href="../articles/v60-export.html">Star Database Export Features</a></li>
    <li><a class="dropdown-item" href="../articles/v70-star_query.html">Performing Multidimensional Queries (also Including Geographic Attributes)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/josesamos/rolap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="rolap_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="rolap_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="rolap_files/viz-1.8.2/viz.js"></script><link href="rolap_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="rolap_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Basics and getting started with the `rolap` package</h1>
                        <h4 data-toc-skip class="author">Jose Samos (<a href="mailto:jsamos@ugr.es" class="email">jsamos@ugr.es</a>)</h4>
            
            <h4 data-toc-skip class="date">2023-07-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/rolap/blob/master/vignettes/rolap.Rmd" class="external-link"><code>vignettes/rolap.Rmd</code></a></small>
      <div class="d-none name"><code>rolap.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em>multidimensional data model</em> was defined in the 1990s
with the aim of supporting data analysis. Data in multidimensional
systems is obtained from operational systems and is transformed to adapt
it to the new structure.</p>
<p>Transformations can be carried out using professional ETL
(<em>Extract, Transform and Load</em>) tools. Recently, tools aimed at
end users have emerged, which are also aimed at performing
transformation operations. All these tools are very useful to carry out
the transformation process, they provide a development environment to
define the transformation operations in a general way.</p>
<p>Frequently, the operations to be performed aim to transform tables
(with data that comes from operational systems) into a ROLAP
(<em>Relational On-Line Analytical Processing</em>) star database, made
up of fact and dimension tables, which implements a multidimensional
system. With the tools mentioned above, this transformation can be
carried out, but it requires a lot of work.</p>
<p>The goal of <code>rolap</code> is to define transformations that
allow you to easily obtain ROLAP star databases, composed by fact and
dimension tables, from operational tables and to be able to export them
in various formats to be used by OLAP query tools.</p>
<p>The rest of this document is structured as follows: First, basic
concepts of dimensional modelling and star databases are summarized. The
following is an illustrative example of how the package works, to show
usage of features it offers. Finally, the document ends with conclusions
and bibliography.</p>
</div>
<div class="section level2">
<h2 id="dimensional-modelling-and-star-databases">Dimensional modelling and star databases<a class="anchor" aria-label="anchor" href="#dimensional-modelling-and-star-databases"></a>
</h2>
<p>The content of this section is a summary based mainly on <span class="citation">Adamson (2010)</span> and <span class="citation">Kimball and Ross (2013)</span>. It is intended to
present the fundamental concepts of the area that are relevant to
understand the functionality, naming and use of the <code>rolap</code>
package.</p>
<div class="section level3">
<h3 id="dimensional-modelling">Dimensional modelling<a class="anchor" aria-label="anchor" href="#dimensional-modelling"></a>
</h3>
<p>Dimensional modelling aims to obtain simple data models. Simplicity
is sought for two reasons: so that decision-makers can easily understand
the data, and also so that they can be easily queried.</p>
<p>In dimensional modelling, the analysis of a business process is
performed <em>modelling how it is measured</em>. The measures are called
<em>facts</em>, and the descriptors of the context of the facts are
<em>dimensions</em>. Facts are numerical data, contain
<em>measures</em>, and decision makers want to see them at various
levels of detail, defined by dimensions.</p>
<p>Not all numerical data is a measure in facts (some tools consider it
that way). In dimensional modelling the designer has to differentiate
between facts and dimensions. Some criteria are considered to
distinguish between them, for example:</p>
<ul>
<li>If it can be defined at different levels of detail then it is a
fact.</li>
<li>If it is quantitative and takes continuous values, then it is a
fact.</li>
<li>If it provides context then it is a dimension.</li>
</ul>
<p>Sometimes there are no measures associated with the business process,
it is simply recorded that the combination of dimensions has occurred.
This situation is often called <em>factless facts</em>, <span class="citation">Jensen, Pedersen, and Thomsen (2010)</span> prefer to
call it <em>measureless facts</em>. In any case, including when no other
measures are available, a measure can be considered that represents the
number of times the combination of dimension values occurs.</p>
<div class="section level4">
<h4 id="dimensions-and-dimension-attributes">Dimensions and dimension attributes<a class="anchor" aria-label="anchor" href="#dimensions-and-dimension-attributes"></a>
</h4>
<p>Attributes considered by the designer as dimensions can be grouped
taking into account the natural affinities between them. In particular,
they can be grouped as they describe the “who, what, where, when, how
and why” associated with the modelled business process. Two attributes
share a natural affinity when they are only related in one context. When
their relationships are determined by transactions or activities, they
can occur in multiple contexts, if this occurs, they must be located in
different dimensions.</p>
<p>In this way, a <em>dimension</em> is made up of a set of naturally
related <em>dimension attributes</em> that describe the context of
facts. Dimensions are used for two purposes: fact <em>selection</em> and
fact <em>grouping</em> with the desired level of detail.</p>
<p>Additionally, in the dimensions <em>hierarchies</em> with
<em>levels</em> and <em>descriptors</em> can be defined. More details
can be found at <span class="citation">Jensen, Pedersen, and Thomsen
(2010)</span>. These concepts are not used in the current version of the
package.</p>
</div>
<div class="section level4">
<h4 id="facts-and-measures">Facts and measures<a class="anchor" aria-label="anchor" href="#facts-and-measures"></a>
</h4>
<p>Facts have a <em>granularity</em>, which is determined by the
attributes of the dimensions that are considered at each moment. Thus, a
measure in a fact has two components, the <em>numerical property</em>
and an <em>formula</em>, frequently the <em>SUM</em> aggregation
function, that allows combining several values of this measure to obtain
a new value of the same measure with a coarser granularity <span class="citation">(Jensen, Pedersen, and Thomsen 2010)</span>.</p>
<p>According to their behaviour to obtain a coarser granularity, three
types of measures are distinguished: <em>additive</em>,
<em>semi-additive</em> and <em>non-additive</em>. For <em>additive
measures</em>, SUM is always a valid formula that maintains the meaning
of the measure when the granularity changes. For <em>semi-additive
measures</em>, there is no point in using SUM when changing the level of
detail in any of the dimensions because the meaning of the measure
changes, this frequently occurs in dimensions that represents time and
measures representing inventory level. For <em>non-additive
measures</em>, values cannot be combined across any dimension using SUM
because the result obtained has a different meaning from the original
measure (generally occurs with ratios, percentages or unit amounts such
as unit cost or unit price).</p>
<p>The most useful measures are additive. If we have non-additive
measures, they can generally be redefined from other additive
measures.</p>
</div>
</div>
<div class="section level3">
<h3 id="star-databases">Star databases<a class="anchor" aria-label="anchor" href="#star-databases"></a>
</h3>
<p>Dimensional models implemented in RDBMS (<em>Relational Database
Management Systems</em>) are known as ROLAP (<em>Relational On-Line
Analytical Processing</em>), if they use a table for each dimension are
called <em>ROLAP star databases</em> because of their resemblance to a
star-like structure: A <em>fact table</em> in the centre and
<em>dimension tables</em> around it. Thus, dimension attributes are
columns of the respective dimension tables, and measures are columns of
the fact table.</p>
<p>Other possible implementations on RDBMS normalize dimensions and are
known as <em>ROLAP snowflake databases</em>. More details can be found
at <span class="citation">Jensen, Pedersen, and Thomsen (2010)</span>.
This is not considered in this package.</p>
<div class="section level4">
<h4 id="dimension-tables">Dimension tables<a class="anchor" aria-label="anchor" href="#dimension-tables"></a>
</h4>
<p>Dimension tables contain the context associated with business process
measures. Although they can contain any type of data, numerical data is
generally not used for dimension attributes because some end user query
tools consider any numeric data as a measure.</p>
<p>Dimension attributes with NULL value are a source of problems when
querying since DBMS and query tools sometimes handle them
inconsistently, the result depends on the product. It is recommended to
avoid the use of NULL and replace them with a descriptive text. In the
case of dates, it is recommended to replace the NULL values with an
arbitrary date in the very far future.</p>
<div class="section level5">
<h5 id="surrogate-keys">Surrogate keys<a class="anchor" aria-label="anchor" href="#surrogate-keys"></a>
</h5>
<p>A dimension table contains dimension attributes and also a
<em>surrogate key</em> column. This column is a unique identifier that
has no intrinsic meaning: It is generally an integer and is the primary
key for the dimension table. In <span class="citation">Adamson
(2010)</span> surrogate keys are easily identifiable by the suffix
“_key” in the column name (and this criterion has also been applied in
<code>rolap</code> package).</p>
<p>Dimension tables also contain <em>natural key</em> columns that
uniquely identify associated entities in an operational system. The
separation of surrogate keys and natural keys allows the star schema to
store changes in dimensions. Therefore, the use of surrogate keys in
dimensions is a solution to the SCD (<em>Slowly Changing
Dimensions</em>) problem.</p>
</div>
<div class="section level5">
<h5 id="special-dimensions">Special dimensions<a class="anchor" aria-label="anchor" href="#special-dimensions"></a>
</h5>
<p>In some cases, for the sake of simplicity, it is helpful to create a
table that contains dimension attributes that have no natural affinities
to each other, generally these are low-cardinality flags and indicators.
The result is what is known as a <em>junk dimension</em>. They do not
require any special support, only the designer’s will to define
them.</p>
<p>Sometimes some dimension attributes are left in the fact table,
usually transaction identifiers. It is considered as the primary key of
a dimension that does not have an associated table, for this reason it
is known as a <em>degenerate dimension</em>. In this package, each
dimension is represented by a table, for a degenerate dimension this
table will have a single attribute (for example, the transaction
identifier). If the dimension table is subsequently deleted, we will
have a degenerate dimension.</p>
<p>Associated with multiple star databases we have the <em>conformed
dimensions</em> that are presented in section <a href="#conformed-dimensions">Conformed dimensions</a>.</p>
</div>
</div>
<div class="section level4">
<h4 id="fact-table">Fact table<a class="anchor" aria-label="anchor" href="#fact-table"></a>
</h4>
<p>At the centre of a star database is the fact table. In addition to
containing measures, the fact table includes <em>foreign keys</em> that
refer to each of the surrogate keys in the dimension tables.</p>
<div class="section level5">
<h5 id="primary-key">Primary key<a class="anchor" aria-label="anchor" href="#primary-key"></a>
</h5>
<p>A subset of foreign keys (along with possibly keys of degenerate
dimensions) is considered to form the <em>primary key</em> of the fact
table.</p>
</div>
<div class="section level5">
<h5 id="grain">Grain<a class="anchor" aria-label="anchor" href="#grain"></a>
</h5>
<p>The subset of dimensions that forms the primary key defines the level
of detail stored in the fact table, which is known as the fact table’s
<em>grain</em>. In the design process, it is very important for the
designer to clearly define the grain of the fact table (it is usually
defined by listing the dimensions whose surrogate keys form its primary
key): It is a way to ensure that all the facts are stored at the same
level of detail.</p>
<p>At the finest grain, a row in the fact table corresponds to the
measures of an event and vice versa, it is not influenced by the
possible reports that may be obtained. When two facts have different
grains, they should be set on different fact tables.</p>
</div>
</div>
<div class="section level4">
<h4 id="constellation">Constellation<a class="anchor" aria-label="anchor" href="#constellation"></a>
</h4>
<p>It is frequent the need to have several fact tables for various
reasons:</p>
<ul>
<li><p>We find measures with different grain.</p></li>
<li><p>There are measures that do not occur simultaneously, for example,
when one occurs, we have no value for others and vice versa.</p></li>
</ul>
<p>In reality it is about different business processes, each one has to
have its own fact table but they have dimensions in common. This is
known as a <a href="https://www.geeksforgeeks.org/fact-constellation-in-data-warehouse-modelling/" class="external-link"><em>constellation</em></a>
which corresponds to the Kimball <em>enterprise data warehouse bus
architecture</em>.</p>
</div>
<div class="section level4">
<h4 id="conformed-dimensions">Conformed dimensions<a class="anchor" aria-label="anchor" href="#conformed-dimensions"></a>
</h4>
<p>When star databases share a set of common dimensions in a
constellation, these dimensions are called <em>conformed
dimensions</em>.</p>
<p>There are several possibilities to have conformed dimensions, the
most obvious form is that the dimension tables share <em>structure</em>
and <em>content</em>, that is, they are identical dimensions. This is
the one considered in this version of the <code>rolap</code>
package.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="an-illustrative-example">An illustrative example<a class="anchor" aria-label="anchor" href="#an-illustrative-example"></a>
</h2>
<p>In this section an illustrative example is developed to show how the
package works.</p>
<div class="section level3">
<h3 id="data-sets">Data sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h3>
<p>To illustrate how the package works we will use a small part of the
<a href="https://catalog.data.gov/dataset/deaths-in-122-u-s-cities-1962-2016-122-cities-mortality-reporting-system" class="external-link">Deaths
in 122 U.S. cities - 1962-2016. 122 Cities Mortality Reporting
System</a> dataset.</p>
<table class="table">
<colgroup>
<col width="2%">
<col width="2%">
<col width="7%">
<col width="3%">
<col width="3%">
<col width="5%">
<col width="13%">
<col width="5%">
<col width="11%">
<col width="12%">
<col width="5%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Pneumonia and Influenza Deaths</th>
<th align="center">All Deaths</th>
<th align="center">&lt;1 year (all cause deaths)</th>
<th align="center">1-24 years (all cause deaths)</th>
<th align="center">25-44 years</th>
<th align="center">45-64 years (all cause deaths)</th>
<th align="center">65+ years (all cause deaths)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">270</td>
<td align="center">14</td>
<td align="center">8</td>
<td align="center">11</td>
<td align="center">70</td>
<td align="center">167</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">01/27/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">12</td>
<td align="center">285</td>
<td align="center">22</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">73</td>
<td align="center">175</td>
</tr>
<tr class="odd">
<td align="center">1963</td>
<td align="center">4</td>
<td align="center">01/26/1963</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">10</td>
<td align="center">276</td>
<td align="center">11</td>
<td align="center">14</td>
<td align="center">17</td>
<td align="center">67</td>
<td align="center">167</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">3</td>
<td align="center">01/18/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">13</td>
<td align="center">325</td>
<td align="center">17</td>
<td align="center">7</td>
<td align="center">24</td>
<td align="center">90</td>
<td align="center">187</td>
</tr>
<tr class="odd">
<td align="center">1964</td>
<td align="center">6</td>
<td align="center">02/08/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">9</td>
<td align="center">244</td>
<td align="center">13</td>
<td align="center">9</td>
<td align="center">14</td>
<td align="center">61</td>
<td align="center">147</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">01/20/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">2</td>
<td align="center">40</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">10</td>
<td align="center">21</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">5</td>
<td align="center">46</td>
<td align="center">6</td>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">15</td>
<td align="center">22</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">8</td>
<td align="center">02/24/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">2</td>
<td align="center">45</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">16</td>
<td align="center">25</td>
</tr>
<tr class="odd">
<td align="center">1963</td>
<td align="center">4</td>
<td align="center">01/26/1963</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">2</td>
<td align="center">46</td>
<td align="center">4</td>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">10</td>
<td align="center">29</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">5</td>
<td align="center">02/01/1964</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">8</td>
<td align="center">45</td>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">11</td>
<td align="center">28</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">9</td>
<td align="center">03/03/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">4</td>
<td align="center">39</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">29</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">2</td>
<td align="center">01/11/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">7</td>
<td align="center">31</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">9</td>
<td align="center">19</td>
</tr>
<tr class="odd">
<td align="center">1964</td>
<td align="center">5</td>
<td align="center">02/01/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">6</td>
<td align="center">27</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">8</td>
<td align="center">17</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">9</td>
<td align="center">02/29/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">0</td>
<td align="center">26</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">8</td>
<td align="center">16</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">01/27/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">1</td>
<td align="center">47</td>
<td align="center">7</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">14</td>
<td align="center">25</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">7</td>
<td align="center">02/17/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">4</td>
<td align="center">57</td>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">21</td>
<td align="center">29</td>
</tr>
<tr class="odd">
<td align="center">1963</td>
<td align="center">3</td>
<td align="center">01/19/1963</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">2</td>
<td align="center">66</td>
<td align="center">7</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">18</td>
<td align="center">36</td>
</tr>
<tr class="even">
<td align="center">1963</td>
<td align="center">7</td>
<td align="center">02/16/1963</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">4</td>
<td align="center">77</td>
<td align="center">6</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">19</td>
<td align="center">44</td>
</tr>
<tr class="odd">
<td align="center">1963</td>
<td align="center">8</td>
<td align="center">02/23/1963</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">6</td>
<td align="center">49</td>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">14</td>
<td align="center">27</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">2</td>
<td align="center">01/11/1964</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">3</td>
<td align="center">53</td>
<td align="center">7</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">16</td>
<td align="center">28</td>
</tr>
</tbody>
</table>
<p>In the table above, all the rows of the <code>ft</code> dataset are
shown. For each week and city, mortality figures by <strong>age</strong>
group and <strong>cause</strong>, considered separately, are included
(i.e., the combination of age group and cause is not included). In the
cause, only a distinction is made between pneumonia or influenza and
others. Regarding the data types, all the columns are of type character,
they have been imported directly as a <code>tibble</code>, without
indicating a specific type.</p>
<p>From this initial dataset, two additional datasets,
<code>ft_num</code> and <code>ft_age</code>, have been defined with the
transformations shown below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://josesamos.github.io/rolap/">rolap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_num</span> <span class="op">&lt;-</span> <span class="va">ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`Pneumonia and Influenza Deaths` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">`Pneumonia and Influenza Deaths`</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`All Deaths` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">`All Deaths`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_age</span> <span class="op">&lt;-</span> <span class="va">ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">`Pneumonia and Influenza Deaths`</span>,<span class="op">-</span><span class="va">`All Deaths`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"All Deaths"</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`All Deaths` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">`All Deaths`</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">Age</span>, <span class="st">" \\(all cause deaths\\)"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>ft_num</code> has the same structure and data as
<code>ft</code>, only the data types of the two cause measures change.
For <code>ft_age</code>, the columns with cause measures are removed and
it is transformed into a tidy table (through
<code><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">tidyr::gather</a></code>), with the only measure of numeric type and
removing redundant descriptions. Below are the first 15 rows of
<code>ft_age</code>.</p>
<table class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="22%">
<col width="10%">
<col width="9%">
<col width="15%">
<col width="11%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Age</th>
<th align="center">All Deaths</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">14</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">01/27/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">22</td>
</tr>
<tr class="odd">
<td align="center">1963</td>
<td align="center">4</td>
<td align="center">01/26/1963</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">11</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">3</td>
<td align="center">01/18/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">17</td>
</tr>
<tr class="odd">
<td align="center">1964</td>
<td align="center">6</td>
<td align="center">02/08/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">01/20/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">&lt;1 year</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">&lt;1 year</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">8</td>
<td align="center">02/24/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">&lt;1 year</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">1963</td>
<td align="center">4</td>
<td align="center">01/26/1963</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">&lt;1 year</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">5</td>
<td align="center">02/01/1964</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">&lt;1 year</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">9</td>
<td align="center">03/03/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">&lt;1 year</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">2</td>
<td align="center">01/11/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">&lt;1 year</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1964</td>
<td align="center">5</td>
<td align="center">02/01/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">&lt;1 year</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1964</td>
<td align="center">9</td>
<td align="center">02/29/1964</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">&lt;1 year</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">01/27/1962</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">&lt;1 year</td>
<td align="center">7</td>
</tr>
</tbody>
</table>
<p><code>ft_num</code> and <code>ft_age</code> are the tables that will
be considered as a starting point to obtain star databases from them in
this example.</p>
</div>
<div class="section level3">
<h3 id="dimensional-modelling-1">Dimensional modelling<a class="anchor" aria-label="anchor" href="#dimensional-modelling-1"></a>
</h3>
<p>For each table, the goal is to define the attributes that correspond
to measures in facts and those that are in dimensions. For facts,
measures and their aggregation functions have to be defined. For
dimensions, attributes with natural affinity must be grouped. Each
attribute should only appear once in the definition.</p>
<p>To avoid having to write the name of the attributes of the table,
with the following function we can have them in the form of a string.
Thus, we can copy and paste each name as needed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ft_num</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; c("Year", "WEEK", "Week Ending Date", "REGION", "State", "City", </span></span>
<span><span class="co">#&gt; "Pneumonia and Influenza Deaths", "All Deaths", "&lt;1 year (all cause deaths)", </span></span>
<span><span class="co">#&gt; "1-24 years (all cause deaths)", "25-44 years", "45-64 years (all cause deaths)", </span></span>
<span><span class="co">#&gt; "65+ years (all cause deaths)")</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ft_age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; c("Year", "WEEK", "Week Ending Date", "REGION", "State", "City", </span></span>
<span><span class="co">#&gt; "Age", "All Deaths")</span></span></code></pre></div>
<div class="section level4">
<h4 id="star-schema">Star Schema<a class="anchor" aria-label="anchor" href="#star-schema"></a>
</h4>
<p>We create an <code>star_schema</code> object using the
<code><a href="../reference/star_schema.html">star_schema()</a></code> function, as shown below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We already have an empty schema, we can add facts and dimensions to
it, as shown in the sections that follow.</p>
</div>
<div class="section level4">
<h4 id="dimensions">Dimensions<a class="anchor" aria-label="anchor" href="#dimensions"></a>
</h4>
<p>We can define the dimensions through variables, using the
<code><a href="../reference/dimension_schema.html">dimension_schema()</a></code> function and then the
<code><a href="../reference/define_dimension.html">define_dimension()</a></code> function in a <code>star_schema</code>
object, or directly in a <code>star_schema</code> object , using the
<code><a href="../reference/define_dimension.html">define_dimension()</a></code> function. In the example below, the
result in both cases is the same. The advantage is that by using
variables we save defining them several times if the same dimension
appears in several star schemes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># definition 1</span></span>
<span><span class="va">when</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimension_schema.html">dimension_schema</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When"</span>,</span>
<span>                         attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Year"</span>,</span>
<span>                                        <span class="st">"WEEK"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">when</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># definition 2</span></span>
<span><span class="va">s_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When"</span>,</span>
<span>                         attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Year"</span>,</span>
<span>                                        <span class="st">"WEEK"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="facts">Facts<a class="anchor" aria-label="anchor" href="#facts"></a>
</h4>
<p>For completeness, facts can also be defined as variables or directly
associated with the star_schema object. As for the dimensions, in the
example below, the result in both cases is the same.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># definition 1</span></span>
<span><span class="va">mrs_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fact_schema.html">fact_schema</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"MRS Cause"</span>,</span>
<span>               measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pneumonia and Influenza Deaths"</span>,</span>
<span>                            <span class="st">"All Deaths"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span><span class="va">mrs_cause</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># definition 2</span></span>
<span><span class="va">s_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"MRS Cause"</span>,</span>
<span>               measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pneumonia and Influenza Deaths"</span>,</span>
<span>                            <span class="st">"All Deaths"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Each measure has an aggregation function associated with it, by
default it is <em>SUM</em>. Alternatively, the <em>MAX</em> or
<em>MIN</em> functions can be used. <em>AVG</em> cannot be used because
the average of averages is not the total average. Instead, a field
called <code>nrow_agg</code> (an alternative name can be specified) is
always added where the number of records added in the result row is
stored. With that value and the result of <em>SUM</em>, the value of the
<em>AVG</em> function can be obtained.</p>
<p>The aggregation functions are needed to get the data at the
granularity defined in the star schema, which can be equal to or coarser
than the granularity defined in the table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"MRS Cause"</span>,</span>
<span>               measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pneumonia and Influenza Deaths"</span>,</span>
<span>                            <span class="st">"All Deaths"</span><span class="op">)</span>,</span>
<span>               agg_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAX"</span>, <span class="st">"SUM"</span><span class="op">)</span>,</span>
<span>               nrow_agg <span class="op">=</span> <span class="st">"Num"</span> </span>
<span>               <span class="op">)</span></span></code></pre></div>
<p>In the above example, aggregation functions have been explicitly
defined for the measures and the default name of the measure
corresponding to the number of records added has been changed.</p>
</div>
<div class="section level4">
<h4 id="star-databases-1">Star databases<a class="anchor" aria-label="anchor" href="#star-databases-1"></a>
</h4>
<p>From a <code>star_schema</code> object and a table
(<code>tibble</code>) that contains all the fields that appear in it,
using the <code><a href="../reference/star_database.html">star_database()</a></code> function, we obtain a
<code>star_database</code> object. As an example we will consider data
on causes.</p>
<p>The definition of the star schema for the data considered for the
cause case is shown below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"MRS Cause"</span>,</span>
<span>               measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pneumonia and Influenza Deaths"</span>,</span>
<span>                            <span class="st">"All Deaths"</span><span class="op">)</span>,</span>
<span>               nrow_agg <span class="op">=</span> <span class="st">"Num"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When"</span>,</span>
<span>                         attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Year"</span>,</span>
<span>                                        <span class="st">"WEEK"</span>,</span>
<span>                                        <span class="st">"Week Ending Date"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Where"</span>,</span>
<span>                          attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REGION"</span>,</span>
<span>                                         <span class="st">"State"</span>,</span>
<span>                                         <span class="st">"City"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next we get the star database.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_database.html">star_database</a></span><span class="op">(</span><span class="va">s_cause</span>, <span class="va">ft_num</span><span class="op">)</span></span></code></pre></div>
<p>For now the objective of this database is to export its tables to be
used in OLAP query tools. Two functions are offered for this purpose,
firstly <code><a href="../reference/snake_case.html">snake_case()</a></code> to transform the column names to snake
case and secondly <code><a href="../reference/as_tibble_list.html">as_tibble_list()</a></code> to generate a
<code>tibble</code> list with the database tables, as shown in the
following example.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l_cause</span> <span class="op">&lt;-</span> <span class="va">db_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The tables of dimensions and facts of the obtained star database are
shown below.</p>
<table style="width:61%;" class="table">
<colgroup>
<col width="15%">
<col width="9%">
<col width="9%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">year</th>
<th align="center">week</th>
<th align="center">week_ending_date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">01/20/1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">01/27/1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962</td>
<td align="center">7</td>
<td align="center">02/17/1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962</td>
<td align="center">8</td>
<td align="center">02/24/1962</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">1962</td>
<td align="center">9</td>
<td align="center">03/03/1962</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">1963</td>
<td align="center">3</td>
<td align="center">01/19/1963</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">1963</td>
<td align="center">4</td>
<td align="center">01/26/1963</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">1963</td>
<td align="center">7</td>
<td align="center">02/16/1963</td>
</tr>
<tr class="odd">
<td align="center">11</td>
<td align="center">1963</td>
<td align="center">8</td>
<td align="center">02/23/1963</td>
</tr>
<tr class="even">
<td align="center">12</td>
<td align="center">1964</td>
<td align="center">2</td>
<td align="center">01/11/1964</td>
</tr>
<tr class="odd">
<td align="center">13</td>
<td align="center">1964</td>
<td align="center">3</td>
<td align="center">01/18/1964</td>
</tr>
<tr class="even">
<td align="center">14</td>
<td align="center">1964</td>
<td align="center">5</td>
<td align="center">02/01/1964</td>
</tr>
<tr class="odd">
<td align="center">15</td>
<td align="center">1964</td>
<td align="center">6</td>
<td align="center">02/08/1964</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">1964</td>
<td align="center">9</td>
<td align="center">02/29/1964</td>
</tr>
</tbody>
</table>
<table style="width:58%;" class="table">
<colgroup>
<col width="16%">
<col width="12%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">region</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
</tr>
</tbody>
</table>
<table style="width:100%;" class="table">
<colgroup>
<col width="14%">
<col width="16%">
<col width="44%">
<col width="17%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">where_key</th>
<th align="center">pneumonia_and_influenza_deaths</th>
<th align="center">all_deaths</th>
<th align="center">num</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">3</td>
<td align="center">11</td>
<td align="center">270</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">40</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">47</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">3</td>
<td align="center">12</td>
<td align="center">285</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">46</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">5</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">57</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">45</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">7</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">39</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">8</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">66</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">9</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">46</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">3</td>
<td align="center">10</td>
<td align="center">276</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">77</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">11</td>
<td align="center">2</td>
<td align="center">6</td>
<td align="center">49</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">12</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">53</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">12</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">31</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">13</td>
<td align="center">3</td>
<td align="center">13</td>
<td align="center">325</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">14</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">45</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">14</td>
<td align="center">4</td>
<td align="center">6</td>
<td align="center">27</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">15</td>
<td align="center">3</td>
<td align="center">9</td>
<td align="center">244</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">4</td>
<td align="center">0</td>
<td align="center">26</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>It can be seen that the data in the fact table has the same
granularity as the data in the original table (they have the same number
of records).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ft_num</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">l_cause</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p>The same can be seen in the <code>num</code> field in the fact table
which shows the number of records added to get each record, in this case
it is always 1. Dimensions contain only the distinct value combinations
for the attribute sets they contain.</p>
<div class="section level5">
<h5 id="rename-fact-measures-and-dimension-attributes">Rename fact measures and dimension attributes<a class="anchor" aria-label="anchor" href="#rename-fact-measures-and-dimension-attributes"></a>
</h5>
<p>In this case it has not been considered necessary, but if desired, it
is possible to rename both the dimension attributes and the fact
measures.</p>
<p>To do this, the functions <code><a href="../reference/get_attribute_names.html">get_attribute_names()</a></code> and
<code><a href="../reference/get_measure_names.html">get_measure_names()</a></code> are available to consult the current
names, and <code><a href="../reference/set_attribute_names.html">set_attribute_names()</a></code> and
<code><a href="../reference/set_measure_names.html">set_measure_names()</a></code> to change them if necessary.</p>
</div>
</div>
<div class="section level4">
<h4 id="constellations">Constellations<a class="anchor" aria-label="anchor" href="#constellations"></a>
</h4>
<p>From two or more star databases we can define a constellation.</p>
<div class="section level5">
<h5 id="definition-of-star-databases">Definition of star databases<a class="anchor" aria-label="anchor" href="#definition-of-star-databases"></a>
</h5>
<p>To more effectively demonstrate the functionality, we are going to
define the star databases with a coarser granularity than the original
tables; additionally we are going to select only some of the rows from
the tables.</p>
<p>For the cause case is shown below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">when</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimension_schema.html">dimension_schema</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"When"</span>,</span>
<span>                         attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">where</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimension_schema.html">dimension_schema</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Where"</span>,</span>
<span>                          attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"State"</span>,</span>
<span>                                         <span class="st">"City"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"MRS Cause"</span>,</span>
<span>               measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pneumonia and Influenza Deaths"</span>,</span>
<span>                            <span class="st">"All Deaths"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">when</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">where</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_num2</span> <span class="op">&lt;-</span> <span class="va">ft_num</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">&gt;</span> <span class="st">"1962"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">City</span> <span class="op">==</span> <span class="st">"Boston"</span> <span class="op">|</span> <span class="va">City</span> <span class="op">==</span> <span class="st">"Bridgeport"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_database.html">star_database</a></span><span class="op">(</span><span class="va">s_cause</span>, <span class="va">ft_num2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l_cause</span> <span class="op">&lt;-</span> <span class="va">db_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The tables obtained as a result are shown below.</p>
<table style="width:25%;" class="table">
<colgroup>
<col width="15%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1963</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1964</td>
</tr>
</tbody>
</table>
<table style="width:46%;" class="table">
<colgroup>
<col width="16%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">MA</td>
<td align="center">Boston</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="13%">
<col width="14%">
<col width="40%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">where_key</th>
<th align="center">pneumonia_and_influenza_deaths</th>
<th align="center">all_deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">46</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">10</td>
<td align="center">276</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">45</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">22</td>
<td align="center">569</td>
<td align="center">2</td>
</tr>
</tbody>
</table>
<p>Next, we define the star database and the rest of the operations in
the case of age groups.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"MRS Age"</span>,</span>
<span>               measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All Deaths"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">when</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">where</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Who"</span>,</span>
<span>                         attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_age2</span> <span class="op">&lt;-</span> <span class="va">ft_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">&lt;</span> <span class="st">"1964"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">City</span> <span class="op">!=</span> <span class="st">"Boston"</span> <span class="op">&amp;</span> <span class="va">City</span> <span class="op">!=</span> <span class="st">"Bridgeport"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_database.html">star_database</a></span><span class="op">(</span><span class="va">s_age</span>, <span class="va">ft_age2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l_age</span> <span class="op">&lt;-</span> <span class="va">db_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The tables obtained as a result are also shown below.</p>
<table style="width:25%;" class="table">
<colgroup>
<col width="15%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1963</td>
</tr>
</tbody>
</table>
<table style="width:44%;" class="table">
<colgroup>
<col width="16%">
<col width="11%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
</tr>
</tbody>
</table>
<table style="width:33%;" class="table">
<colgroup>
<col width="13%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">who_key</th>
<th align="center">age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1-24 years</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">25-44 years</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">45-64 years</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">65+ years</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">&lt;1 year</td>
</tr>
</tbody>
</table>
<table style="width:82%;" class="table">
<colgroup>
<col width="15%">
<col width="16%">
<col width="13%">
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">where_key</th>
<th align="center">who_key</th>
<th align="center">all_deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">35</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">54</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">10</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">29</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">13</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">51</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">107</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">16</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
<p>As we have filtered the data, it can be seen that the dimension
tables only contain the necessary data for each star database but, for
common dimensions, they share the same structure.</p>
</div>
<div class="section level5">
<h5 id="constellation-definition">Constellation definition<a class="anchor" aria-label="anchor" href="#constellation-definition"></a>
</h5>
<p>Next we define a constellation formed by the two star databases.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constellation.html">constellation</a></span><span class="op">(</span><span class="st">"MRS"</span>, <span class="va">db_cause</span>, <span class="va">db_age</span><span class="op">)</span></span></code></pre></div>
<p>Constellation tables can also be exported as a tibble list.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lc</span> <span class="op">&lt;-</span> <span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Below are the tables of the constellation’s star databases. The
instances of the dimensions have been integrated so that the tables are
common to both databases.</p>
<table style="width:25%;" class="table">
<colgroup>
<col width="15%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1963</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1964</td>
</tr>
</tbody>
</table>
<table style="width:46%;" class="table">
<colgroup>
<col width="16%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">MA</td>
<td align="center">Boston</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
</tr>
</tbody>
</table>
<table style="width:33%;" class="table">
<colgroup>
<col width="13%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">who_key</th>
<th align="center">age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1-24 years</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">25-44 years</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">45-64 years</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">65+ years</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">&lt;1 year</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="13%">
<col width="14%">
<col width="40%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">where_key</th>
<th align="center">pneumonia_and_influenza_deaths</th>
<th align="center">all_deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">46</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">3</td>
<td align="center">10</td>
<td align="center">276</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">45</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">3</td>
<td align="center">22</td>
<td align="center">569</td>
<td align="center">2</td>
</tr>
</tbody>
</table>
<table style="width:82%;" class="table">
<colgroup>
<col width="15%">
<col width="16%">
<col width="13%">
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">where_key</th>
<th align="center">who_key</th>
<th align="center">all_deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">35</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">54</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">5</td>
<td align="center">10</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">4</td>
<td align="center">3</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">29</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">4</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">13</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">51</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">107</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">5</td>
<td align="center">16</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
<p>These tables can be directly exported in the format required by the
OLAP query tool that we are going to use.</p>
<p>Constellations can be defined from star databases and also from other
constellations. For example, let’s define a new star database based on
the previous examples.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_age2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"MRS Age 2"</span>,</span>
<span>               measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All Deaths"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">when</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">where</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Who"</span>,</span>
<span>                         attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_age2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_database.html">star_database</a></span><span class="op">(</span><span class="va">s_age2</span>, <span class="va">ft_age</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Next we define a constellation, it is made up of the previously
defined constellation and the new star database.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constellation.html">constellation</a></span><span class="op">(</span><span class="st">"MRS2"</span>, <span class="va">ct</span>, <span class="va">db_age2</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="export-results">Export results<a class="anchor" aria-label="anchor" href="#export-results"></a>
</h3>
<p>To continue working with the result of the implementation of the
multidimensional database (star database or constellation) it can be
exported as a <code>tibble</code> list, suitable for example to pass the
data to a spreadsheet, or as an object of the class <code>dm</code>,
which allows passing the data to a RDBMS.</p>
<p>In some cases, we may be interested in having the data in the form of
a table again, especially if we want to carry out some statistical
analysis with the integrated data. We can export them as a single
<code>tibble</code> list.</p>
<p>Functions are defined, applicable to objects of both star databases
and constellations.</p>
<div class="section level4">
<h4 id="tibble-list">
<code>tibble</code> list<a class="anchor" aria-label="anchor" href="#tibble-list"></a>
</h4>
<p>The following shows the results that are obtained for a star
database.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $when</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   when_key year </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1 1963 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        2 1964 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $where</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   where_key state city      </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 CT    Bridgeport</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         2 MA    Boston    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mrs_cause</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   when_key where_key pneumonia_and_influenza_deaths all_deaths nrow_agg</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1         1                              2         46        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        1         2                             10        276        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        2         1                              8         45        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        2         2                             22        569        2</span></span></code></pre></div>
<p>Also for a constellation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_tibble_list.html">as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $when</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   when_key year </span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1 1962 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        2 1963 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        3 1964 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $where</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   where_key state city      </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 CT    Bridgeport</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         2 CT    Hartford  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         3 MA    Boston    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         4 MA    Cambridge </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $who</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;   who_key age        </span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       1 1-24 years </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       2 25-44 years</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       3 45-64 years</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>       4 65+ years  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>       5 &lt;1 year    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mrs_cause</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   when_key where_key pneumonia_and_influenza_deaths all_deaths nrow_agg</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        2         1                              2         46        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        2         3                             10        276        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        3         1                              8         45        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        3         3                             22        569        2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mrs_age</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 5</span></span></span>
<span><span class="co">#&gt;    when_key where_key who_key all_deaths nrow_agg</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        1         2       1          2        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>        1         2       2          3        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        1         2       3         35        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        1         2       4         54        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        1         2       5         10        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        1         4       1          0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        1         4       2          2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        1         4       3          7        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        1         4       4         29        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        1         4       5          1        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        2         2       1          5        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>        2         2       2         13        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>        2         2       3         51        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>        2         2       4        107        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>        2         2       5         16        3</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="dm-object">
<code>dm</code> object<a class="anchor" aria-label="anchor" href="#dm-object"></a>
</h4>
<p>The <a href="https://cran.r-project.org/package=dm" class="external-link"><code>dm</code></a> package
allows you to link tables implemented using the <code>tibble</code>
class in R with tables in RDBMS.</p>
<p>The following example shows the transformation of a star database to
an object of class <code>dm</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># star database</span></span>
<span><span class="va">db_cause_dm</span> <span class="op">&lt;-</span> <span class="va">db_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">db_cause_dm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dm"</span></span>
<span><span class="va">db_cause_dm</span></span>
<span><span class="co">#&gt; <span style="color: #FFAFFF;">──</span> <span style="color: #FFAFFF;">Metadata</span> <span style="color: #FFAFFF;">────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Tables: `when`, `where`, `mrs_cause`</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; Primary keys: 3</span></span>
<span><span class="co">#&gt; Foreign keys: 2</span></span></code></pre></div>
<p>Also for a constellation.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># constellation</span></span>
<span><span class="va">ct_dm</span> <span class="op">&lt;-</span> <span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ct_dm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dm"</span></span>
<span><span class="va">ct_dm</span></span>
<span><span class="co">#&gt; <span style="color: #FFAFFF;">──</span> <span style="color: #FFAFFF;">Metadata</span> <span style="color: #FFAFFF;">────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Tables: `when`, `where`, `who`, `mrs_cause`, `mrs_age`</span></span>
<span><span class="co">#&gt; Columns: 17</span></span>
<span><span class="co">#&gt; Primary keys: 5</span></span>
<span><span class="co">#&gt; Foreign keys: 5</span></span></code></pre></div>
<p>For example, the <code>dm</code> class object can be used to
represent the constellation tables, as it’s shown in the following (it
can also be used to store them in a DBMS).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>rankdir <span class="op">=</span> <span class="st">"LR"</span>, view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"mrs_age\" [id = \"mrs_age\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_age<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_key\">who_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key, where_key, who_key\"><U>when_key, where_key, who_key<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"mrs_cause\" [id = \"mrs_cause\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_cause<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">pneumonia_and_influenza_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key, where_key\"><U>when_key, where_key<\/U><\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">year<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who\" [id = \"who\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_key\"><U>who_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">age<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"mrs_cause\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_cause_1\"]\n\"mrs_age\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_age_1\"]\n\"mrs_cause\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_cause_2\"]\n\"mrs_age\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_age_2\"]\n\"mrs_age\":\"who_key\"->\"who\":\"who_key\" [id=\"mrs_age_3\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>In the example below, a local <em>SQLite</em> database is used to
demonstrate how to store the model in a database. <code>dm</code> works
with any RDBMS supported by <code>DBI</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ct_dm_db</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/copy_dm_to.html" class="external-link">copy_dm_to</a></span><span class="op">(</span><span class="va">db</span>, <span class="va">ct_dm</span><span class="op">)</span></span>
<span><span class="va">ct_dm_db</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">──</span> <span style="color: #00BB00;">Table source</span> <span style="color: #00BB00;">────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; src:  sqlite 3.49.1 []</span></span>
<span><span class="co">#&gt; <span style="color: #FFAFFF;">──</span> <span style="color: #FFAFFF;">Metadata</span> <span style="color: #FFAFFF;">────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Tables: `when`, `where`, `who`, `mrs_cause`, `mrs_age`</span></span>
<span><span class="co">#&gt; Columns: 17</span></span>
<span><span class="co">#&gt; Primary keys: 5</span></span>
<span><span class="co">#&gt; Foreign keys: 5</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="single-tibble-list">Single <code>tibble</code> list<a class="anchor" aria-label="anchor" href="#single-tibble-list"></a>
</h4>
<p>The following shows the results that are obtained for a star database
seen as a single <code>tibble</code> list. Each single
<code>tibble</code> is the result of performing an <em>inner join</em>
between the fact table and the dimension tables.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_single_tibble_list.html">as_single_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $mrs_cause</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   year  state city       pneumonia_and_influenza_deaths all_deaths nrow_agg</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1963  CT    Bridgeport                              2         46        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1963  MA    Boston                                 10        276        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1964  CT    Bridgeport                              8         45        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1964  MA    Boston                                 22        569        2</span></span></code></pre></div>
<p>Also for a constellation.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_single_tibble_list.html">as_single_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $mrs_cause</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   year  state city       pneumonia_and_influenza_deaths all_deaths nrow_agg</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1963  CT    Bridgeport                              2         46        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1963  MA    Boston                                 10        276        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1964  CT    Bridgeport                              8         45        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1964  MA    Boston                                 22        569        2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mrs_age</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 6</span></span></span>
<span><span class="co">#&gt;    year  state city      age         all_deaths nrow_agg</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1962  CT    Hartford  1-24 years           2        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1962  CT    Hartford  25-44 years          3        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1962  CT    Hartford  45-64 years         35        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1962  CT    Hartford  65+ years           54        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1962  CT    Hartford  &lt;1 year             10        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1962  MA    Cambridge 1-24 years           0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1962  MA    Cambridge 25-44 years          2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1962  MA    Cambridge 45-64 years          7        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1962  MA    Cambridge 65+ years           29        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1962  MA    Cambridge &lt;1 year              1        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 1963  CT    Hartford  1-24 years           5        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 1963  CT    Hartford  25-44 years         13        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 1963  CT    Hartford  45-64 years         51        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 1963  CT    Hartford  65+ years          107        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 1963  CT    Hartford  &lt;1 year             16        3</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p><code>rolap</code> package offers a set of operations that allow us
to transform tables into star databases. From several star databases you
can define a constellation with conformed dimensions.</p>
<p>Operations have been designed to be intuitive and easy to use. The
result greatly facilitates the data transformation process for the
exposed situation.</p>
<p>The implementation of the multidimensional database obtained can be
exported to work with multidimensional analysis tools on spreadsheets or
RDBMS.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-adamson2010star" class="csl-entry">
Adamson, Christopher. 2010. <em>Star Schema: The Complete
Reference</em>. McGraw Hill Professional.
</div>
<div id="ref-jensen2010multi" class="csl-entry">
Jensen, Christian S., Torben Bach Pedersen, and Christian Thomsen. 2010.
<em>Multidimensional Databases and Data Warehousing</em>. Morgan &amp;
Claypool Publishers.
</div>
<div id="ref-kimball2013data" class="csl-entry">
Kimball, Ralph, and Margy Ross. 2013. <em>The Data Warehouse Toolkit:
The Definitive Guide to Dimensional Modeling</em>. John Wiley &amp;
Sons.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>

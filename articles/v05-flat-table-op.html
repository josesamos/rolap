<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rolap">
<title>Obtaining and transforming flat tables • rolap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Obtaining and transforming flat tables">
<meta property="og:description" content="rolap">
<meta property="og:image" content="https://josesamos.github.io/rolap/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rolap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/rolap.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v05-flat-table-op.html">Obtaining and transforming flat tables</a>
    <a class="dropdown-item" href="../articles/v10-rpd.html">Definition of role-playing and role dimensions</a>
    <a class="dropdown-item" href="../articles/v20-rdbms-dm.html">Star databases and RDBMS through the `dm` and `rolap` packages</a>
    <a class="dropdown-item" href="../articles/v30-dim-instances.html">Integration of dimension instances</a>
    <a class="dropdown-item" href="../articles/v40-refresh.html">Incremental refresh of star databases</a>
    <a class="dropdown-item" href="../articles/v50-deploy.html">Deployment of star databases with incremental refresh</a>
    <a class="dropdown-item" href="../articles/v60-export.html">Star Database Export Features</a>
    <a class="dropdown-item" href="../articles/v70-star_query.html">Performing Multidimensional Queries with the `rolap` Package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josesamos/rolap/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="v05-flat-table-op_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="v05-flat-table-op_files/viz-1.8.2/viz.js"></script><link href="v05-flat-table-op_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="v05-flat-table-op_files/grViz-binding-1.0.10/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Obtaining and transforming flat tables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/rolap/blob/HEAD/vignettes/v05-flat-table-op.Rmd" class="external-link"><code>vignettes/v05-flat-table-op.Rmd</code></a></small>
      <div class="d-none name"><code>v05-flat-table-op.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The goal of the <code>rolap</code> package is to define
transformations that allow you to easily obtain ROLAP star databases,
composed by fact and dimension tables, from operational tables. The
starting point for defining a star database with the <code>rolap</code>
package is a <strong>flat table</strong>.</p>
<p>A flat database or flat-file database is a database that only
contains a single table. A <em>flat table</em> is a generally
denormalized table that is not related to other tables. It is not
necessarily tidy data (in the sense of the <a href="https://CRAN.R-project.org/package=tidyverse" class="external-link"><code>tidyverse</code></a>
package) but in each column all the data must be of the same type, so
that it can be easily stored in a RDBMS (<em>Relational Database
Management System</em>). It is common for transactional systems to allow
their data to be exported as a flat table.</p>
<p>The <code>rolap</code> package includes a set of operations that
allow defining, transforming and integrating tables to obtain a flat
table from which we can define star databases. To work with tables to
obtain a flat table, the <code>flat_table</code> class is defined: Its
main objective is to allow the integration of tables from different
sources to obtain a flat table with all the data. It is described in
this document using a practical example.</p>
<p>First, the datasets used in the example are presented. Then,
functions are shown to define flat tables from various sources. It
continues with a section dedicated to flat table join operations and
another to flat table transformation operations. It finishes with the
functions to define star databases and constellations from the flat
tables and, finally, with the conclusions.</p>
</div>
<div class="section level2">
<h2 id="data-sets">Data sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h2>
<p>This section describes the data sets used in the example.</p>
<div class="section level3">
<h3 id="us-cities-mortality-reporting-system">122 US Cities Mortality Reporting System<a class="anchor" aria-label="anchor" href="#us-cities-mortality-reporting-system"></a>
</h3>
<p>To illustrate how the package works we will use a small part of the
<a href="https://catalog.data.gov/dataset/deaths-in-122-u-s-cities-1962-2016-122-cities-mortality-reporting-system" class="external-link">Deaths
in 122 U.S. cities - 1962-2016. 122 Cities Mortality Reporting
System</a> dataset.</p>
<p>We have developed the examples in this document using the dataset
downloaded from the source. To reproduce them more easily, from the
original file, we have stored in the package a file with the same format
as the original file but that includes only 1% of its data, selected at
random<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Additionally, data from Boston and Baltimore have been
excluded to show the incremental data refresh.&lt;/p&gt;"><sup>1</sup></a>,
which is accessed below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://josesamos.github.io/rolap/">rolap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"extdata"</span>,</span>
<span>    <span class="st">"mrs_122_us_cities_1962_2016.csv"</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"rolap"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">mrs_ft</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/read_flat_table_file.html">read_flat_table_file</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'mrs'</span>, <span class="va">file</span>, unknown_value <span class="op">=</span> <span class="st">"Not available"</span><span class="op">)</span></span></code></pre></div>
<p>Using the <code><a href="../reference/read_flat_table_file.html">read_flat_table_file()</a></code> function we read a
table stored in a text file and create a <code>flat_table</code> object
with a name. Through the parameter <code>unknown_value</code> we can
define the value to use when there is no value available.</p>
<p>Below are the first records of the table. We access the table using
the <code><a href="../reference/get_table.html">get_table()</a></code> function for the object of the
<code>flat_table</code> class.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_table.html">get_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ft</span><span class="op">)</span>, split.table <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="2%">
<col width="7%">
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="5%">
<col width="11%">
<col width="12%">
<col width="5%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Pneumonia and Influenza Deaths</th>
<th align="center">All Deaths</th>
<th align="center">&lt;1 year (all cause deaths)</th>
<th align="center">1-24 years (all cause deaths)</th>
<th align="center">25-44 years</th>
<th align="center">45-64 years (all cause deaths)</th>
<th align="center">65+ years (all cause deaths)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">01/06/1962</td>
<td align="center">7</td>
<td align="center">OK</td>
<td align="center">Tulsa</td>
<td align="center">2</td>
<td align="center">69</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">17</td>
<td align="center">41</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Lynn</td>
<td align="center">1</td>
<td align="center">28</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">11</td>
<td align="center">14</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Somerville</td>
<td align="center">2</td>
<td align="center">21</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">5</td>
<td align="center">DC</td>
<td align="center">Washington</td>
<td align="center">10</td>
<td align="center">220</td>
<td align="center">20</td>
<td align="center">8</td>
<td align="center">20</td>
<td align="center">72</td>
<td align="center">100</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">8</td>
<td align="center">CO</td>
<td align="center">Colorado Springs</td>
<td align="center">2</td>
<td align="center">12</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
<td align="center">2</td>
<td align="center">NJ</td>
<td align="center">Elizabeth</td>
<td align="center">2</td>
<td align="center">32</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">11</td>
<td align="center">16</td>
</tr>
</tbody>
</table>
<p>This data set has mortality data from 122 US cities. The geographic
data that it includes corresponds to the <em>REGION</em>, <em>State</em>
and <em>City</em> attributes of the table.</p>
<p>Apart from this data, we may be interested in adding additional
geographical information, such as data on the population of these cities
or their specific location.</p>
</div>
<div class="section level3">
<h3 id="database-of-us-cities">Database of US cities<a class="anchor" aria-label="anchor" href="#database-of-us-cities"></a>
</h3>
<p>In package <code>maps</code>, we find the data set
<code>us.cities</code> corresponding to a database of US cities with the
information that interests us.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">maps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/maps/man/us.cities.html" class="external-link">us.cities</a></span><span class="op">)</span>, split.table <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<table style="width:88%;" class="table">
<colgroup>
<col width="18%">
<col width="19%">
<col width="12%">
<col width="11%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">name</th>
<th align="center">country.etc</th>
<th align="center">pop</th>
<th align="center">lat</th>
<th align="center">long</th>
<th align="center">capital</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Abilene TX</td>
<td align="center">TX</td>
<td align="center">113888</td>
<td align="center">32.45</td>
<td align="center">-99.74</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">Akron OH</td>
<td align="center">OH</td>
<td align="center">206634</td>
<td align="center">41.08</td>
<td align="center">-81.52</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">Alameda CA</td>
<td align="center">CA</td>
<td align="center">70069</td>
<td align="center">37.77</td>
<td align="center">-122.3</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">Albany GA</td>
<td align="center">GA</td>
<td align="center">75510</td>
<td align="center">31.58</td>
<td align="center">-84.18</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">Albany NY</td>
<td align="center">NY</td>
<td align="center">93576</td>
<td align="center">42.67</td>
<td align="center">-73.8</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">Albany OR</td>
<td align="center">OR</td>
<td align="center">45535</td>
<td align="center">44.62</td>
<td align="center">-123.1</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>The content of the table fields is obvious, except for field
<em>capital</em>, which is described in the help as containing capital
status indication (0 for non-capital, 1 for capital, 2 for state
capital).</p>
</div>
</div>
<div class="section level2">
<h2 id="flat-tables">Flat tables<a class="anchor" aria-label="anchor" href="#flat-tables"></a>
</h2>
<p>Our goal is to have all available data, possibly from multiple data
sources, in a single table, a flat table. We have defined the
<code>flat_table</code> class to represent the tables, transform them
and be able to integrate them.</p>
<p>This section, for the data sets that are used, describes the
functions to create a <code>flat_table</code> object and to access and
modify its characteristics.</p>
<div class="section level3">
<h3 id="create-flat_table-objects">Create <code>flat_table</code> objects<a class="anchor" aria-label="anchor" href="#create-flat_table-objects"></a>
</h3>
<p>For the mortality data in US cities, we have created the
<code>flat_table</code> object by directly reading the data from the
file where it was stored, using the <code><a href="../reference/read_flat_table_file.html">read_flat_table_file()</a></code>
function. The package also includes the
<code><a href="../reference/read_flat_table_folder.html">read_flat_table_folder()</a></code> function to read and integrate all
text files in a folder into a <code>flat_table</code> object.</p>
<p>From a dataset in a data frame, using the <code><a href="../reference/flat_table.html">flat_table()</a></code>
function, we obtain a <code>flat_table</code> object, as shown below for
the US cities dataset.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usc_ft</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/flat_table.html">flat_table</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'us_cities'</span>, instances <span class="op">=</span> <span class="fu">maps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/maps/man/us.cities.html" class="external-link">us.cities</a></span><span class="op">)</span></span></code></pre></div>
<p>Using this function, we are going to create an additional
<code>flat_table</code> object that allows us to associate the capital
status codes with their description. To do this, we define before a data
frame with the codes and their descriptions and, from it, we create the
object, as shown below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">capital_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'0'</span>, <span class="st">'1'</span>, <span class="st">'2'</span><span class="op">)</span>,</span>
<span>  status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'non-capital'</span>, <span class="st">'capital'</span>, <span class="st">'state capital'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cs_ft</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/flat_table.html">flat_table</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'capital_status'</span>, instances <span class="op">=</span> <span class="va">capital_status</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="flat_table-attributes-and-measures">
<code>flat_table</code> <em>attributes</em> and
<em>measures</em><a class="anchor" aria-label="anchor" href="#flat_table-attributes-and-measures"></a>
</h3>
<p>Following the criteria of OLAP system design, we distinguish between
<em>attributes</em> and <em>measures</em> in the <code>flat_table</code>
class, considering the focus of attention of the data:</p>
<ul>
<li><p><em>Measures</em>: They answer the question “how much?”,
referring to the focus of attention.</p></li>
<li><p><em>Attributes</em>: They define the rest of the context of the
focus of attention.</p></li>
</ul>
<p>Not all numerical data are necessarily measures, some should be
considered as attributes, it mainly depends on the focus of attention
that we consider.</p>
<p>When we define a flat table, its fields are classified based on their
type as attributes or measures. Numeric fields are considered measures,
the rest of the fields are attributes. No functions are used to find out
the type, only the type defined in the starting data frame is
considered. In the case of obtaining data from text files, all data is
defined as character type, that is, it is classified as attributes.</p>
<p>For this example, our focus is the Mortality Reporting System data.
We have to define the attributes and measures with this point of
view.</p>
<div class="section level4">
<h4 id="mortality-reporting-system">Mortality Reporting System<a class="anchor" aria-label="anchor" href="#mortality-reporting-system"></a>
</h4>
<p>Using the functions shown below we consult the attributes and
measures.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_attribute_names.html">get_attribute_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Year"                           "WEEK"                          </span></span>
<span><span class="co">#&gt;  [3] "Week Ending Date"               "REGION"                        </span></span>
<span><span class="co">#&gt;  [5] "State"                          "City"                          </span></span>
<span><span class="co">#&gt;  [7] "Pneumonia and Influenza Deaths" "All Deaths"                    </span></span>
<span><span class="co">#&gt;  [9] "&lt;1 year (all cause deaths)"     "1-24 years (all cause deaths)" </span></span>
<span><span class="co">#&gt; [11] "25-44 years"                    "45-64 years (all cause deaths)"</span></span>
<span><span class="co">#&gt; [13] "65+ years (all cause deaths)"</span></span>
<span></span>
<span><span class="va">mrs_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_measure_names.html">get_measure_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Since the data comes from a text file, all fields have been defined
as attributes.</p>
<div class="section level5">
<h5 id="measures">Measures<a class="anchor" aria-label="anchor" href="#measures"></a>
</h5>
<p>This is a starting point, next we will see how to change the initial
classification. Using the <code><a href="../reference/transform_to_measure.html">transform_to_measure()</a></code> function,
we transform attributes into measures. In some cases it is required to
previously transform the data (remove the thousands separator or change
the decimal separator), this can be indicated by the function
parameters, although it is not necessary in this case.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/transform_to_measure.html">transform_to_measure</a></span><span class="op">(</span></span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">'Pneumonia and Influenza Deaths'</span>,</span>
<span>      <span class="st">'All Deaths'</span>,</span>
<span>      <span class="st">'&lt;1 year (all cause deaths)'</span>,</span>
<span>      <span class="st">'1-24 years (all cause deaths)'</span>,</span>
<span>      <span class="st">'25-44 years'</span>,</span>
<span>      <span class="st">'45-64 years (all cause deaths)'</span>,</span>
<span>      <span class="st">'65+ years (all cause deaths)'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">mrs_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_attribute_names.html">get_attribute_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Year"             "WEEK"             "Week Ending Date" "REGION"          </span></span>
<span><span class="co">#&gt; [5] "State"            "City"</span></span>
<span></span>
<span><span class="va">mrs_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_measure_names.html">get_measure_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pneumonia and Influenza Deaths" "All Deaths"                    </span></span>
<span><span class="co">#&gt; [3] "&lt;1 year (all cause deaths)"     "1-24 years (all cause deaths)" </span></span>
<span><span class="co">#&gt; [5] "25-44 years"                    "45-64 years (all cause deaths)"</span></span>
<span><span class="co">#&gt; [7] "65+ years (all cause deaths)"</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="attributes">Attributes<a class="anchor" aria-label="anchor" href="#attributes"></a>
</h5>
<p>We can change the format of numeric attributes. The main motivation
is usually that the alphabetical order coincides with the numerical
order. This is often important in user query tools (e.g. <em>Power
BI</em>).</p>
<p>Below is the change for the <em>WEEK</em> field. It is enough to
indicate the width. The result is that it fills the width with white
spaces on the left, thus achieving the stated objective (for example,
output ” 2” instead of “2” to come before “10” when data is
presented).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/transform_attribute_format.html">transform_attribute_format</a></span><span class="op">(</span>attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'WEEK'</span><span class="op">)</span>,</span>
<span>                             width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>For example, in this way we will have as output ” 2” instead of “2”,
so that alphabetically ordered it is placed before “10” instead of after
it, as it’s shown in the following.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_table.html">get_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">table</span><span class="op">[[</span><span class="st">'WEEK'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] " 1" " 2" " 3" " 4" " 5" " 6" " 7" " 8" " 9" "10"</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="us-cities">US cities<a class="anchor" aria-label="anchor" href="#us-cities"></a>
</h4>
<p>In this case, the starting data was in a data frame, where each
column has a data type associated with it. The initial classification is
as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usc_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_attribute_names.html">get_attribute_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "name"        "country.etc"</span></span>
<span></span>
<span><span class="va">usc_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_measure_names.html">get_measure_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "pop"     "lat"     "long"    "capital"</span></span></code></pre></div>
<p>From the point of view of the Mortality Reporting System, all of this
data can be considered as attributes. Using the parameters of the
<code><a href="../reference/transform_to_attribute.html">transform_to_attribute()</a></code> function, we define the format of
the transformation from numeric data to string, as shown below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usc_ft</span> <span class="op">&lt;-</span> <span class="va">usc_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/transform_to_attribute.html">transform_to_attribute</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="st">'capital'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/transform_to_attribute.html">transform_to_attribute</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="st">'pop'</span>,</span>
<span>                         width <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/transform_to_attribute.html">transform_to_attribute</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lat'</span>, <span class="st">'long'</span><span class="op">)</span>,</span>
<span>                         width <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                         decimal_places <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>In particular, by using the <code>width</code> parameter, as done
before to transform the numerical attributes, we can make the order of
the string data match the numerical order.</p>
</div>
<div class="section level4">
<h4 id="capital-status">Capital status<a class="anchor" aria-label="anchor" href="#capital-status"></a>
</h4>
<p>For the capital status table, the columns have been defined as
string, therefore both are attributes, which is appropriate for the
focus of attention.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cs_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_attribute_names.html">get_attribute_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "code"   "status"</span></span>
<span></span>
<span><span class="va">cs_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_measure_names.html">get_measure_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="joining-flat-tables">Joining flat tables<a class="anchor" aria-label="anchor" href="#joining-flat-tables"></a>
</h2>
<p>We currently have the data of interest in three tables and our goal
is to have all the data in a single flat table: we have to join the
tables.</p>
<p>To join tables represented by <code>flat_table</code> objects, we
must define a lookup table, so that the other table must contain a
foreign key that allows them to be related.</p>
<div class="section level3">
<h3 id="joining-us-cities-and-capital-status-tables">Joining US cities and capital status tables<a class="anchor" aria-label="anchor" href="#joining-us-cities-and-capital-status-tables"></a>
</h3>
<p>Using the <code><a href="../reference/lookup_table.html">lookup_table()</a></code> function we define the
attributes that make up the primary key of a loop table, as shown below
for the capital status table.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cs_ft</span> <span class="op">&lt;-</span> <span class="va">cs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lookup_table.html">lookup_table</a></span><span class="op">(</span>pk_attributes <span class="op">=</span> <span class="st">'code'</span><span class="op">)</span></span></code></pre></div>
<p>The primary key is made up of the <em>code</em> field.</p>
<p>In the definition of the lookup table, it is verified that the set of
attributes that are indicated actually form a primary key. Likewise, if
they do not form a primary key, the same <code><a href="../reference/lookup_table.html">lookup_table()</a></code>
function can be used to group the data using the aggregation functions
indicated for the rest of the attributes and measures in the table.</p>
<p>Once we have a lookup table, we can join any other table to it using
its primary key, which will be the foreign key of the other table, as
shown below for the US cities table using the
<code><a href="../reference/join_lookup_table.html">join_lookup_table()</a></code> function. We only have to indicate the
attributes that make up the foreign key and the lookup table.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usc_ft</span> <span class="op">&lt;-</span> <span class="va">usc_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/join_lookup_table.html">join_lookup_table</a></span><span class="op">(</span>fk_attributes <span class="op">=</span> <span class="st">'capital'</span>, lookup <span class="op">=</span> <span class="va">cs_ft</span><span class="op">)</span></span></code></pre></div>
<p>Below is the data table with the result obtained.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft</span> <span class="op">&lt;-</span> <span class="va">usc_ft</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_table.html">get_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ft</span><span class="op">)</span>, split.table <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="17%">
<col width="12%">
<col width="12%">
<col width="8%">
<col width="11%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">name</th>
<th align="center">country.etc</th>
<th align="center">capital</th>
<th align="center">pop</th>
<th align="center">lat</th>
<th align="center">long</th>
<th align="center">status</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Abilene TX</td>
<td align="center">TX</td>
<td align="center">0</td>
<td align="center">113,888</td>
<td align="center">32.5</td>
<td align="center">-99.7</td>
<td align="center">non-capital</td>
</tr>
<tr class="even">
<td align="center">Akron OH</td>
<td align="center">OH</td>
<td align="center">0</td>
<td align="center">206,634</td>
<td align="center">41.1</td>
<td align="center">-81.5</td>
<td align="center">non-capital</td>
</tr>
<tr class="odd">
<td align="center">Alameda CA</td>
<td align="center">CA</td>
<td align="center">0</td>
<td align="center">70,069</td>
<td align="center">37.8</td>
<td align="center">-122.3</td>
<td align="center">non-capital</td>
</tr>
<tr class="even">
<td align="center">Albany GA</td>
<td align="center">GA</td>
<td align="center">0</td>
<td align="center">75,510</td>
<td align="center">31.6</td>
<td align="center">-84.2</td>
<td align="center">non-capital</td>
</tr>
<tr class="odd">
<td align="center">Albany NY</td>
<td align="center">NY</td>
<td align="center">2</td>
<td align="center">93,576</td>
<td align="center">42.7</td>
<td align="center">-73.8</td>
<td align="center">state capital</td>
</tr>
<tr class="even">
<td align="center">Albany OR</td>
<td align="center">OR</td>
<td align="center">0</td>
<td align="center">45,535</td>
<td align="center">44.6</td>
<td align="center">-123.1</td>
<td align="center">non-capital</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="joining-mortality-reporting-system-and-us-cities-tables">Joining Mortality Reporting System and US cities tables<a class="anchor" aria-label="anchor" href="#joining-mortality-reporting-system-and-us-cities-tables"></a>
</h3>
<p>First of all we must define table X as a lookup table. Its primary
key is formed exclusively by the <em>name</em> attribute.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usc_ft</span> <span class="op">&lt;-</span> <span class="va">usc_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lookup_table.html">lookup_table</a></span><span class="op">(</span>pk_attributes <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span></span></code></pre></div>
<p>If we consult the Mortality Reporting System table again (for
convenience it is shown again below), we verify that we do not have a
field that corresponds directly to the primary key: we must merge two
fields (<em>City</em> and <em>State</em>) to obtain it.</p>
<table class="table">
<colgroup>
<col width="2%">
<col width="2%">
<col width="7%">
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="5%">
<col width="11%">
<col width="12%">
<col width="5%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Pneumonia and Influenza Deaths</th>
<th align="center">All Deaths</th>
<th align="center">&lt;1 year (all cause deaths)</th>
<th align="center">1-24 years (all cause deaths)</th>
<th align="center">25-44 years</th>
<th align="center">45-64 years (all cause deaths)</th>
<th align="center">65+ years (all cause deaths)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">01/06/1962</td>
<td align="center">7</td>
<td align="center">OK</td>
<td align="center">Tulsa</td>
<td align="center">2</td>
<td align="center">69</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">17</td>
<td align="center">41</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Lynn</td>
<td align="center">1</td>
<td align="center">28</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">11</td>
<td align="center">14</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Somerville</td>
<td align="center">2</td>
<td align="center">21</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">5</td>
<td align="center">DC</td>
<td align="center">Washington</td>
<td align="center">10</td>
<td align="center">220</td>
<td align="center">20</td>
<td align="center">8</td>
<td align="center">20</td>
<td align="center">72</td>
<td align="center">100</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">8</td>
<td align="center">CO</td>
<td align="center">Colorado Springs</td>
<td align="center">2</td>
<td align="center">12</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
<td align="center">2</td>
<td align="center">NJ</td>
<td align="center">Elizabeth</td>
<td align="center">2</td>
<td align="center">32</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">11</td>
<td align="center">16</td>
</tr>
</tbody>
</table>
<p>We can add new fields to a table using the
<code><a href="../reference/add_custom_column.html">add_custom_column()</a></code> function. It is given the name of the
new field and a function that returns its values: the function receives
the original table as a parameter. Depending on the type of data
returned, it will be classified as an attribute or measure in the
flat_table object.</p>
<p>Below is the definition of function <code>city_state()</code> and the
new field obtained through it. We will make the changes in a temporary
variable, until we are sure that they are appropriate.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to define a derived column</span></span>
<span><span class="va">city_state</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">$</span><span class="va">City</span>, <span class="st">' '</span>, <span class="va">table</span><span class="op">$</span><span class="va">State</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mrs_ft_TMP</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_custom_column.html">add_custom_column</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'city_state'</span>, definition <span class="op">=</span> <span class="va">city_state</span><span class="op">)</span></span></code></pre></div>
<p>Once we have the foreign key, before carrying out the join operation,
we can check if all the instances will find a match in the lookup table.
This operation is performed by the <code><a href="../reference/check_lookup_table.html">check_lookup_table()</a></code>
function, with the same parameters as the
<code><a href="../reference/join_lookup_table.html">join_lookup_table()</a></code> function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft_TMP</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/check_lookup_table.html">check_lookup_table</a></span><span class="op">(</span>fk_attributes <span class="op">=</span> <span class="st">'city_state'</span>, lookup <span class="op">=</span> <span class="va">usc_ft</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt;   city_state    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Washington DC </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Wilimington DE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> NA NA</span></span></code></pre></div>
<p>In addition to the data that is not defined, we check that there are
two instances that do not have a correspondence in the lookup table.</p>
<ul>
<li>“Washington DC” appears in the lookup table as “WASHINGTON DC”.</li>
<li>“Wilimington DE” has a typo, it is “Wilmington DE”.</li>
</ul>
<p>First, let’s define a value for the undefined data. Through the
<code><a href="../reference/replace_empty_values.html">replace_empty_values()</a></code> function, it assigns them the value
that we indicated at the time of creating the <code>flat_table</code>
object in the <code>unknown_value</code> parameter.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/replace_empty_values.html">replace_empty_values</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If we do not indicate any attributes, it considers all the attributes
of the table.</p>
<p>We define the custom column again.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_custom_column.html">add_custom_column</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'city_state'</span>, definition <span class="op">=</span> <span class="va">city_state</span><span class="op">)</span></span></code></pre></div>
<p>Once these changes have been made, we will carry out the rest of the
modifications to the data. We have considered it appropriate to correct
the first value in the lookup table and the second in the table where
the error is. Corrections are carried out using the
<code><a href="../reference/replace_attribute_values.html">replace_attribute_values()</a></code> function.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usc_ft</span> <span class="op">&lt;-</span> <span class="va">usc_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/replace_attribute_values.html">replace_attribute_values</a></span><span class="op">(</span></span>
<span>    attributes <span class="op">=</span> <span class="st">'name'</span>,</span>
<span>    old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'WASHINGTON DC'</span><span class="op">)</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Washington DC'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/replace_attribute_values.html">replace_attribute_values</a></span><span class="op">(</span></span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'City'</span>, <span class="st">'city_state'</span><span class="op">)</span>,</span>
<span>    old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Wilimington'</span>, <span class="st">'Wilimington DE'</span><span class="op">)</span>,</span>
<span>    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Wilmington'</span>, <span class="st">'Wilmington DE'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>If we perform the check again, we observe that all the defined data
corresponds in the lookup table and that the unknown values have the
value indicated in the definition of the flat_table object.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/check_lookup_table.html">check_lookup_table</a></span><span class="op">(</span>fk_attributes <span class="op">=</span> <span class="st">'city_state'</span>, lookup <span class="op">=</span> <span class="va">usc_ft</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   city_state                 </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Not available Not available</span></span></code></pre></div>
<p>We perform the join operation using the
<code><a href="../reference/join_lookup_table.html">join_lookup_table()</a></code> function.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/join_lookup_table.html">join_lookup_table</a></span><span class="op">(</span>fk_attributes <span class="op">=</span> <span class="st">'city_state'</span>, lookup <span class="op">=</span> <span class="va">usc_ft</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check the attributes of the result. Using the
<code><a href="../reference/get_attribute_names.html">get_attribute_names()</a></code> function, we can indicate that we
want them in vector definition format.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_attribute_names.html">get_attribute_names</a></span><span class="op">(</span>as_definition <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "c('Year', 'WEEK', 'Week Ending Date', 'REGION', 'State', 'City', 'city_state', 'country.etc', 'capital', 'pop', 'lat', 'long', 'status')"</span></span></code></pre></div>
<p>There are attributes that we do not need, although it is not strictly
necessary for our objective, we can exclude them using the
<code><a href="../reference/select_attributes.html">select_attributes()</a></code> function. We can use the definition of
the vector obtained by the previous function to perform the
selection.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_attributes.html">select_attributes</a></span><span class="op">(</span></span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">'Year'</span>,</span>
<span>      <span class="st">'WEEK'</span>,</span>
<span>      <span class="st">'Week Ending Date'</span>,</span>
<span>      <span class="st">'REGION'</span>,</span>
<span>      <span class="st">'State'</span>,</span>
<span>      <span class="st">'City'</span>,</span>
<span>      <span class="st">'city_state'</span>,</span>
<span>      <span class="st">'status'</span>,</span>
<span>      <span class="st">'pop'</span>,</span>
<span>      <span class="st">'lat'</span>,</span>
<span>      <span class="st">'long'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>As a result, we have a flat table with all the data we need.</p>
</div>
</div>
<div class="section level2">
<h2 id="flat-table-transformation">Flat table transformation<a class="anchor" aria-label="anchor" href="#flat-table-transformation"></a>
</h2>
<p>We have made some transformations on the <code>flat_table</code>
objects in the previous section in order to carry out the join
operations. In this section we are going to perform some additional
transformations.</p>
<div class="section level3">
<h3 id="separate-measures">Separate measures<a class="anchor" aria-label="anchor" href="#separate-measures"></a>
</h3>
<p>The original Mortality Reporting System data includes details related
to the cause of death and others to the age group of the people, but
without including the cause. That is, we have data at two different
granularities or levels of detail. Let’s separate them into different
tables.</p>
<p>The separation is carried out by means of the
<code><a href="../reference/separate_measures.html">separate_measures()</a></code> function, in which we can indicate
lists of measures and the name<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If we indicate more names than groups of measures, the
measures not included in other groups are also included in a new
group.&lt;/p&gt;"><sup>2</sup></a> of each new flat table that will form the
result.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l_mrs_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/separate_measures.html">separate_measures</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Pneumonia and Influenza Deaths'</span>,</span>
<span>      <span class="st">'All Deaths'</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">'&lt;1 year (all cause deaths)'</span>,</span>
<span>      <span class="st">'1-24 years (all cause deaths)'</span>,</span>
<span>      <span class="st">'25-44 years'</span>,</span>
<span>      <span class="st">'45-64 years (all cause deaths)'</span>,</span>
<span>      <span class="st">'65+ years (all cause deaths)'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mrs_cause'</span>, <span class="st">'mrs_age'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mrs_cause_ft</span> <span class="op">&lt;-</span> <span class="va">l_mrs_ft</span><span class="op">[[</span><span class="st">'mrs_cause'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">mrs_age_ft</span> <span class="op">&lt;-</span> <span class="va">l_mrs_ft</span><span class="op">[[</span><span class="st">'mrs_age'</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>The result is that we have two <code>flat_table</code> objects, one
with the data referring to the causes and the other with the age
data.</p>
</div>
<div class="section level3">
<h3 id="transform-column-names">Transform column names<a class="anchor" aria-label="anchor" href="#transform-column-names"></a>
</h3>
<p>One of the transformations that we can do on the names of the table
columns is to change them according to the snake case criterion. We
apply this transformation for the table with cause data, as shown
below.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_cause_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_cause_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can also rename attributes and measures using the
<code><a href="../reference/set_attribute_names.html">set_attribute_names()</a></code> and <code><a href="../reference/set_measure_names.html">set_measure_names()</a></code>
functions. In this case we don’t need to use them.</p>
</div>
<div class="section level3">
<h3 id="transform-measure-names-into-attribute-values">Transform measure names into attribute values<a class="anchor" aria-label="anchor" href="#transform-measure-names-into-attribute-values"></a>
</h3>
<p>Below are the first instances of the flat table with data on people’s
ages.</p>
<table class="table">
<colgroup>
<col width="2%">
<col width="2%">
<col width="6%">
<col width="3%">
<col width="2%">
<col width="6%">
<col width="8%">
<col width="5%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="10%">
<col width="11%">
<col width="5%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">city_state</th>
<th align="center">status</th>
<th align="center">pop</th>
<th align="center">lat</th>
<th align="center">long</th>
<th align="center">&lt;1 year (all cause deaths)</th>
<th align="center">1-24 years (all cause deaths)</th>
<th align="center">25-44 years</th>
<th align="center">45-64 years (all cause deaths)</th>
<th align="center">65+ years (all cause deaths)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">01/06/1962</td>
<td align="center">7</td>
<td align="center">OK</td>
<td align="center">Tulsa</td>
<td align="center">Tulsa OK</td>
<td align="center">non-capital</td>
<td align="center">379,833</td>
<td align="center">36.1</td>
<td align="center">-95.9</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">17</td>
<td align="center">41</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Lynn</td>
<td align="center">Lynn MA</td>
<td align="center">non-capital</td>
<td align="center">89,786</td>
<td align="center">42.5</td>
<td align="center">-71.0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">11</td>
<td align="center">14</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Somerville</td>
<td align="center">Somerville MA</td>
<td align="center">non-capital</td>
<td align="center">74,802</td>
<td align="center">42.4</td>
<td align="center">-71.1</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">5</td>
<td align="center">DC</td>
<td align="center">Washington</td>
<td align="center">Washington DC</td>
<td align="center">non-capital</td>
<td align="center">548,359</td>
<td align="center">38.9</td>
<td align="center">-77.0</td>
<td align="center">20</td>
<td align="center">8</td>
<td align="center">20</td>
<td align="center">72</td>
<td align="center">100</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">8</td>
<td align="center">CO</td>
<td align="center">Colorado Springs</td>
<td align="center">Colorado Springs CO</td>
<td align="center">non-capital</td>
<td align="center">375,744</td>
<td align="center">38.9</td>
<td align="center">-104.8</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
<td align="center">2</td>
<td align="center">NJ</td>
<td align="center">Elizabeth</td>
<td align="center">Elizabeth NJ</td>
<td align="center">non-capital</td>
<td align="center">124,552</td>
<td align="center">40.7</td>
<td align="center">-74.2</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">11</td>
<td align="center">16</td>
</tr>
</tbody>
</table>
<p>Number of rows in the table: 3342</p>
<p>Additionally, the number of rows in the table is shown.</p>
<p>The names of the measures can be considered values of a new attribute
called <em>age</em>. The numerical values would correspond to a new
measure that we can call <em>all_deaths</em>.</p>
<p>This is precisely the transformation carried out by the
<code><a href="../reference/transform_to_values.html">transform_to_values()</a></code> function. It is not necessary to
indicate more parameters apart from the new names of the attribute and
the measure because it considers all the available measures to carry out
the described transformation.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_age_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_age_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/transform_to_values.html">transform_to_values</a></span><span class="op">(</span>attribute <span class="op">=</span> <span class="st">'age'</span>,</span>
<span>                      measure <span class="op">=</span> <span class="st">'all_deaths'</span><span class="op">)</span></span></code></pre></div>
<p>Once we have obtained the values of the new variable that were in the
form of column names, we can adapt the rest of the name according to the
snake case criterion.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_age_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_age_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can eliminate from the literals that describe the age,
the part that is now described by the new measure. To do this, we use
the <code><a href="../reference/replace_string.html">replace_string()</a></code> function that allows us to replace a
string with the value indicated for the selected attributes. This
function, unlike function <code><a href="../reference/replace_attribute_values.html">replace_attribute_values()</a></code>, does
not look for the instances to be equal to the indicated value but rather
to contain it.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_age_ft</span> <span class="op">&lt;-</span> <span class="va">mrs_age_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/replace_string.html">replace_string</a></span><span class="op">(</span></span>
<span>    attributes <span class="op">=</span> <span class="st">'age'</span>,</span>
<span>    string <span class="op">=</span> <span class="st">' (all cause deaths)'</span>,</span>
<span>    replacement <span class="op">=</span> <span class="st">''</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The result can be seen in the table records shown below.</p>
<table class="table">
<colgroup>
<col width="4%">
<col width="4%">
<col width="12%">
<col width="5%">
<col width="5%">
<col width="12%">
<col width="14%">
<col width="9%">
<col width="6%">
<col width="4%">
<col width="5%">
<col width="6%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="center">year</th>
<th align="center">week</th>
<th align="center">week_ending_date</th>
<th align="center">region</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">city_state</th>
<th align="center">status</th>
<th align="center">pop</th>
<th align="center">lat</th>
<th align="center">long</th>
<th align="center">age</th>
<th align="center">all_deaths</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">01/06/1962</td>
<td align="center">7</td>
<td align="center">OK</td>
<td align="center">Tulsa</td>
<td align="center">Tulsa OK</td>
<td align="center">non-capital</td>
<td align="center">379,833</td>
<td align="center">36.1</td>
<td align="center">-95.9</td>
<td align="center">&lt;1 year</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Lynn</td>
<td align="center">Lynn MA</td>
<td align="center">non-capital</td>
<td align="center">89,786</td>
<td align="center">42.5</td>
<td align="center">-71.0</td>
<td align="center">&lt;1 year</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Somerville</td>
<td align="center">Somerville MA</td>
<td align="center">non-capital</td>
<td align="center">74,802</td>
<td align="center">42.4</td>
<td align="center">-71.1</td>
<td align="center">&lt;1 year</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">5</td>
<td align="center">DC</td>
<td align="center">Washington</td>
<td align="center">Washington DC</td>
<td align="center">non-capital</td>
<td align="center">548,359</td>
<td align="center">38.9</td>
<td align="center">-77.0</td>
<td align="center">&lt;1 year</td>
<td align="center">20</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">8</td>
<td align="center">CO</td>
<td align="center">Colorado Springs</td>
<td align="center">Colorado Springs CO</td>
<td align="center">non-capital</td>
<td align="center">375,744</td>
<td align="center">38.9</td>
<td align="center">-104.8</td>
<td align="center">&lt;1 year</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
<td align="center">2</td>
<td align="center">NJ</td>
<td align="center">Elizabeth</td>
<td align="center">Elizabeth NJ</td>
<td align="center">non-capital</td>
<td align="center">124,552</td>
<td align="center">40.7</td>
<td align="center">-74.2</td>
<td align="center">&lt;1 year</td>
<td align="center">5</td>
</tr>
</tbody>
</table>
<p>Number of rows in the table: 16565</p>
<p>With this transformation we would have the flat table with the
appropriate format to define the star database from it.</p>
<p>In some cases we may be interested in performing the reverse
operation: transforming attribute values into variable names, taking the
value of the available measure. This operation can be performed using
the <code><a href="../reference/transform_from_values.html">transform_from_values()</a></code> function, as shown below.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_age_ft_TMP</span> <span class="op">&lt;-</span> <span class="va">mrs_age_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/transform_from_values.html">transform_from_values</a></span><span class="op">(</span></span>
<span>    attribute <span class="op">=</span> <span class="st">'age'</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The result is shown below, along with the number of rows in the
table.</p>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="9%">
<col width="4%">
<col width="4%">
<col width="9%">
<col width="11%">
<col width="7%">
<col width="5%">
<col width="3%">
<col width="4%">
<col width="5%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="center">year</th>
<th align="center">week</th>
<th align="center">week_ending_date</th>
<th align="center">region</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">city_state</th>
<th align="center">status</th>
<th align="center">pop</th>
<th align="center">lat</th>
<th align="center">long</th>
<th align="center">&lt;1 year</th>
<th align="center">1-24 years</th>
<th align="center">25-44 years</th>
<th align="center">45-64 years</th>
<th align="center">65+ years</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">01/06/1962</td>
<td align="center">7</td>
<td align="center">OK</td>
<td align="center">Tulsa</td>
<td align="center">Tulsa OK</td>
<td align="center">non-capital</td>
<td align="center">379,833</td>
<td align="center">36.1</td>
<td align="center">-95.9</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">17</td>
<td align="center">41</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Lynn</td>
<td align="center">Lynn MA</td>
<td align="center">non-capital</td>
<td align="center">89,786</td>
<td align="center">42.5</td>
<td align="center">-71.0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">11</td>
<td align="center">14</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Somerville</td>
<td align="center">Somerville MA</td>
<td align="center">non-capital</td>
<td align="center">74,802</td>
<td align="center">42.4</td>
<td align="center">-71.1</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">5</td>
<td align="center">DC</td>
<td align="center">Washington</td>
<td align="center">Washington DC</td>
<td align="center">non-capital</td>
<td align="center">548,359</td>
<td align="center">38.9</td>
<td align="center">-77.0</td>
<td align="center">20</td>
<td align="center">8</td>
<td align="center">20</td>
<td align="center">72</td>
<td align="center">100</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">01/13/1962</td>
<td align="center">8</td>
<td align="center">CO</td>
<td align="center">Colorado Springs</td>
<td align="center">Colorado Springs CO</td>
<td align="center">non-capital</td>
<td align="center">375,744</td>
<td align="center">38.9</td>
<td align="center">-104.8</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">02/03/1962</td>
<td align="center">2</td>
<td align="center">NJ</td>
<td align="center">Elizabeth</td>
<td align="center">Elizabeth NJ</td>
<td align="center">non-capital</td>
<td align="center">124,552</td>
<td align="center">40.7</td>
<td align="center">-74.2</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">11</td>
<td align="center">16</td>
</tr>
</tbody>
</table>
<p>Number of rows in the table: 3342</p>
<p>If we compare the number of rows in the table with the original, we
see that it coincides.</p>
</div>
</div>
<div class="section level2">
<h2 id="definition-of-the-star-databases">Definition of the star databases<a class="anchor" aria-label="anchor" href="#definition-of-the-star-databases"></a>
</h2>
<p>The definition of the star schemas and star databases for the flat
tables obtained is shown in the following sections and is discussed in
detail in the vignette titled <em>Basics and getting started with the
rolap package</em>, <code><a href="../articles/rolap.html">vignette("rolap")</a></code>.</p>
<div class="section level3">
<h3 id="mrs-cause-star-database">MRS Cause star database<a class="anchor" aria-label="anchor" href="#mrs-cause-star-database"></a>
</h3>
<p>We consult the names of the fields to define the star schema.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_cause_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_attribute_names.html">get_attribute_names</a></span><span class="op">(</span>as_definition <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "c('year', 'week', 'week_ending_date', 'region', 'state', 'city', 'city_state', 'status', 'pop', 'lat', 'long')"</span></span>
<span></span>
<span><span class="va">mrs_cause_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_measure_names.html">get_measure_names</a></span><span class="op">(</span>as_definition <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "c('pneumonia_and_influenza_deaths', 'all_deaths')"</span></span></code></pre></div>
<p>We define dimensions and facts. We define the dimensions as variables
to be able to share them more easily.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">when</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimension_schema.html">dimension_schema</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'when'</span>,</span>
<span>  attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'year'</span>, </span>
<span>    <span class="st">'week'</span>, </span>
<span>    <span class="st">'week_ending_date'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">where</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimension_schema.html">dimension_schema</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>  attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'region'</span>,</span>
<span>    <span class="st">'state'</span>,</span>
<span>    <span class="st">'city'</span>,</span>
<span>    <span class="st">'city_state'</span>,</span>
<span>    <span class="st">'status'</span>,</span>
<span>    <span class="st">'pop'</span>,</span>
<span>    <span class="st">'lat'</span>,</span>
<span>    <span class="st">'long'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">s_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span><span class="fu"><a href="../reference/fact_schema.html">fact_schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">'mrs_cause'</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pneumonia_and_influenza_deaths'</span>, <span class="st">'all_deaths'</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">when</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">where</span><span class="op">)</span></span></code></pre></div>
<p>From the schema, we use the <code><a href="../reference/as_star_database.html">as_star_database()</a></code> function
that allows us to obtain a <code>star_database</code> object from a
<code>flat_table</code> object.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_cause_db</span> <span class="op">&lt;-</span> <span class="va">mrs_cause_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_star_database.html">as_star_database</a></span><span class="op">(</span><span class="va">s_cause</span><span class="op">)</span></span></code></pre></div>
<p>Below is the representation of the star database tables that we can
export to any RDBMS through the functionality of the <a href="https://cran.r-project.org/package=dm" class="external-link"><code>dm</code></a>
package.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_dm</span> <span class="op">&lt;-</span> <span class="va">mrs_cause_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">db_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>rankdir <span class="op">=</span> <span class="st">"LR"</span>, view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7e3d6465ce91dcc0a686" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-7e3d6465ce91dcc0a686">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"mrs_cause\" [id = \"mrs_cause\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_cause<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">pneumonia_and_influenza_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">year<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week_ending_date<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">region<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city_state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">status<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">pop<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">lat<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">long<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"mrs_cause\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_cause_1\"]\n\"mrs_cause\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_cause_2\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="mrs-age-star-database">MRS Age star database<a class="anchor" aria-label="anchor" href="#mrs-age-star-database"></a>
</h3>
<p>In this case, we define the additional dimension of this design and
the schema by reusing the previous definition of the other
dimensions.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimension_schema.html">dimension_schema</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'who'</span>,</span>
<span>  attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'age'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">s_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_facts.html">define_facts</a></span><span class="op">(</span><span class="fu"><a href="../reference/fact_schema.html">fact_schema</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">'mrs_age'</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'all_deaths'</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">when</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">where</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span><span class="va">who</span><span class="op">)</span></span></code></pre></div>
<p>We obtain the <code>star_dabase</code> object from the
<code>flat_table</code> object and the defined schema.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_age_db</span> <span class="op">&lt;-</span> <span class="va">mrs_age_ft</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_star_database.html">as_star_database</a></span><span class="op">(</span><span class="va">s_age</span><span class="op">)</span></span></code></pre></div>
<p>We also show the graphical representation of the tables.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_dm</span> <span class="op">&lt;-</span> <span class="va">mrs_age_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">db_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>rankdir <span class="op">=</span> <span class="st">"LR"</span>, view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e1c63abede22847922ae" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e1c63abede22847922ae">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"mrs_age\" [id = \"mrs_age\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_age<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_key\">who_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">year<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week_ending_date<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">region<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city_state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">status<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">pop<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">lat<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">long<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who\" [id = \"who\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_key\"><U>who_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">age<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"mrs_age\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_age_1\"]\n\"mrs_age\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_age_2\"]\n\"mrs_age\":\"who_key\"->\"who\":\"who_key\" [id=\"mrs_age_3\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="constellation">Constellation<a class="anchor" aria-label="anchor" href="#constellation"></a>
</h3>
<p>From the two star databases we define a constellation that shares
common dimensions.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constellation.html">constellation</a></span><span class="op">(</span><span class="st">"mrs"</span>, <span class="va">mrs_cause_db</span>, <span class="va">mrs_age_db</span><span class="op">)</span></span></code></pre></div>
<p>And we show the graphic representation of the tables.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_dm</span> <span class="op">&lt;-</span> <span class="va">mrs_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_dm_class.html">as_dm_class</a></span><span class="op">(</span>pk_facts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">db_dm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://dm.cynkra.com/reference/dm_draw.html" class="external-link">dm_draw</a></span><span class="op">(</span>rankdir <span class="op">=</span> <span class="st">"LR"</span>, view_type <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8eb037700ec24e351107" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-8eb037700ec24e351107">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\npack=true\npackmode= \"node\"\n\n  \"mrs_age\" [id = \"mrs_age\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_age<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"who_key\">who_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"mrs_cause\" [id = \"mrs_cause\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#00005CAA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#00008BFF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">mrs_cause<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"when_key\">when_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\" PORT=\"where_key\">where_key<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">pneumonia_and_influenza_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">all_deaths<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCCCE7FF\">nrow_agg<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"when\" [id = \"when\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">when<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"when_key\"><U>when_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">year<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">week_ending_date<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"where\" [id = \"where\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">where<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"where_key\"><U>where_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">region<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">city_state<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">status<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">pop<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">lat<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">long<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"who\" [id = \"who\", label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#004200AA\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#006400FF\" BORDER=\"0\"><FONT COLOR=\"#FFFFFF\">who<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\" PORT=\"who_key\"><U>who_key<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#CCE0CCFF\">age<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"mrs_cause\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_cause_1\"]\n\"mrs_age\":\"when_key\"->\"when\":\"when_key\" [id=\"mrs_age_1\"]\n\"mrs_cause\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_cause_2\"]\n\"mrs_age\":\"where_key\"->\"where\":\"where_key\" [id=\"mrs_age_2\"]\n\"mrs_age\":\"who_key\"->\"who\":\"who_key\" [id=\"mrs_age_3\"]\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>From the data obtained from the operational systems we want to
implement ROLAP star databases. The intermediate step that we consider
are flat tables: the data from which a star database is obtained must be
in the form of a flat table.</p>
<p>This document shows, using an example, the functions available in the
<code>rolap</code> package to define, transform and integrate flat
tables from tables obtained from various data sources.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

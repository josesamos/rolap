---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# rolap

<!-- badges: start -->
<!-- badges: end -->

The goal of rolap is to ...

## Installation

You can install the development version of rolap from [GitHub](https://github.com/) with:

``` r
# install.packages("rolap")
devtools::install_github("josesamos/rolap")
```

## Example

Original data as a starting point, stored in `ft`.

```{r setup, echo = FALSE}
library(rolap)
```

```{r, results = "asis", echo = FALSE}
pander::pandoc.table(ft, split.table = Inf)
```

This is a basic example which shows you how to solve a common problem:

```{r example}
library(rolap)

when <- dimension_schema(name = "When",
                         attributes = c("Year"))

where <- dimension_schema(name = "Where",
                          attributes = c("REGION",
                                         "State",
                                         "City"))

s <- star_schema() |>
  define_facts(name = "MRS Cause",
               measures = c("Pneumonia and Influenza Deaths",
                            "All Deaths")) |>
  define_dimension(when) |>
  define_dimension(where)

ft_num <- ft |>
  dplyr::mutate(`Pneumonia and Influenza Deaths` = as.integer(`Pneumonia and Influenza Deaths`)) |>
  dplyr::mutate(`All Deaths` = as.integer(`All Deaths`))

db <- star_database(s, ft_num) |>
  snake_case()
```

The tables of dimensions and facts of the obtained star database are shown below.

```{r, results = "asis", echo = FALSE}
pander::pandoc.table(db$instance$dimensions$when$dimension, split.table = Inf)
pander::pandoc.table(db$instance$dimensions$where$dimension, split.table = Inf)
pander::pandoc.table(db$instance$facts$mrs_cause$facts, split.table = Inf)
```

```{r example2}

s2 <- star_schema() |>
  define_facts(name = "MRS Age",
               measures = c("All Deaths")) |>
  define_dimension(when) |>
  define_dimension(where) |>
  define_dimension(name = "Who",
                         attributes = c("Age"))

ft2 <- ft |>
  dplyr::select(-`Pneumonia and Influenza Deaths`, -`All Deaths`) |>
  tidyr::gather("Age", "All Deaths", 7:11) |>
  dplyr::mutate(`All Deaths` = as.integer(`All Deaths`)) |>
  dplyr::mutate(Age = stringr::str_replace(Age, " \\(all cause deaths\\)", ""))

db2 <- star_database(s2, ft2) |>
  snake_case()
```

The tables of dimensions and facts of the obtained star database are shown below.

```{r, results = "asis", echo = FALSE}
pander::pandoc.table(db2$instance$dimensions$when$dimension, split.table = Inf)
pander::pandoc.table(db2$instance$dimensions$where$dimension, split.table = Inf)
pander::pandoc.table(db2$instance$dimensions$who$dimension, split.table = Inf)
pander::pandoc.table(db2$instance$facts$mrs_age$facts, split.table = Inf)
```
